<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FeiCoin åŒºå—é“¾æµè§ˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 6px;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            min-height: calc(100vh - 150px);
        }
        
        .operations-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .logs-panel {
            position: sticky;
            top: 30px;
            height: fit-content;
            max-height: calc(100vh - 150px);
            overflow: hidden;
        }

        .section {
            margin-bottom: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }


        .transfer-form {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 12px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 12px;
        }
        
        .form-row .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            border: 2px solid #333;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .log-level-info { color: #00ff00; }
        .log-level-error { color: #ff0000; }
        .log-level-warning { color: #ffff00; }
        .log-level-transfer { color: #00bfff; }
        .log-level-success { color: #32cd32; }
        
        .transfer-separator {
            border: none;
            border-top: 2px solid #444;
            margin: 15px 0;
            background: linear-gradient(90deg, transparent 0%, #00bfff 20%, #00bfff 80%, transparent 100%);
            height: 2px;
            position: relative;
        }
        
        .transfer-separator::before {
            content: 'ğŸ’¸ è½¬è´¦æµç¨‹ ğŸ’¸';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e1e1e;
            color: #00bfff;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .transfer-end-separator {
            border: none;
            border-top: 2px solid #444;
            margin: 15px 0;
            background: linear-gradient(90deg, transparent 0%, #32cd32 20%, #32cd32 80%, transparent 100%);
            height: 2px;
            position: relative;
        }
        
        .transfer-end-separator::before {
            content: 'âœ… è½¬è´¦å®Œæˆ âœ…';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e1e1e;
            color: #32cd32;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .transfer-log {
            background: rgba(0, 191, 255, 0.1);
            border-left: 3px solid #00bfff;
            padding-left: 10px;
            margin: 2px 0;
        }
        
        .success-log {
            background: rgba(50, 205, 50, 0.15);
            border-left: 3px solid #32cd32;
            padding-left: 10px;
            margin: 2px 0;
        }

        .status {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .blockchain-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .info-card {
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 3px solid #4CAF50;
        }

        .info-card h4 {
            color: #666;
            font-size: 0.8em;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .info-card .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
        }

        /* é’±åŒ…ç®¡ç†æ ·å¼ */
        .wallet-management,
        .validator-management {
            margin-top: 20px;
        }
        
        .wallet-actions,
        .validator-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .wallet-form,
        .validator-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        
        .wallet-form h3,
        .validator-form h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }
        
        .wallet-form textarea,
        .validator-form textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
        }
        
        .wallet-list,
        .validator-list {
            margin-top: 20px;
        }
        
        .wallet-item,
        .validator-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .wallet-item h4,
        .validator-item h4 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .wallet-address,
        .validator-address {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
            background: #f5f5f5;
            padding: 5px 8px;
            border-radius: 4px;
            margin: 5px 0;
            word-break: break-all;
        }
        
        .wallet-balance {
            margin: 8px 0;
            padding: 8px 12px;
            background: #e8f5e8;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .validator-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .validator-status.bonded {
            background: #d4edda;
            color: #155724;
        }
        
        .validator-status.unbonded {
            background: #f8d7da;
            color: #721c24;
        }
        
        .validator-tokens {
            font-weight: bold;
            color: #2196F3;
        }
        
        .mnemonic-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        
        .mnemonic-warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            color: #721c24;
            font-weight: bold;
        }
        
        /* é’±åŒ…ç®€ä»‹æ¨¡å¼æ ·å¼ */
        .wallet-item-compact {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin: 6px;
            border-left: 3px solid #4CAF50;
            display: block;
            min-width: 180px;
            flex: 1;
        }
        
        .wallets-container-horizontal {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .wallet-compact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wallet-compact-info {
            flex: 1;
        }
        
        .wallet-compact-name {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 2px;
            font-size: 0.9em;
        }
        
        .wallet-compact-balance {
            font-size: 0.8em;
            color: #666;
            font-family: 'Courier New', monospace;
            margin-bottom: 4px;
        }
        
        .wallet-compact-actions {
            display: flex;
            gap: 4px;
            align-items: center;
            flex-shrink: 0;
        }
        
        .wallet-compact-actions-mini {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-top: 6px;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 0.75em;
            border-radius: 3px;
        }
        
        .btn-mini {
            padding: 3px 6px;
            font-size: 0.7em;
            border-radius: 3px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-mini:hover {
            transform: scale(1.05);
        }
        
        .wallet-details {
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            display: none;
        }
        
        .wallet-details.expanded {
            display: block;
        }
        
        .wallet-details .wallet-address {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #666;
            background: #fff;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            word-break: break-all;
            border: 1px solid #ddd;
        }
        
        .expand-btn {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            font-size: 0.85em;
            text-decoration: underline;
            padding: 2px 4px;
            white-space: nowrap;
        }
        
        .expand-btn:hover {
            color: #0056b3;
        }
        
        /* å¥–åŠ±ç®¡ç†æ ·å¼ */
        .rewards-management {
            margin-top: 20px;
        }
        
        .rewards-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 15px 0;
            border-left: 4px solid #FF9800;
        }
        
        .rewards-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .rewards-header h3 {
            color: #FF9800;
            margin: 0;
            font-size: 1.1em;
        }
        
        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #fff3e0;
            border-radius: 6px;
            margin: 8px 0;
            border: 1px solid #ffcc02;
        }
        
        .reward-info {
            flex: 1;
        }
        
        .reward-amount {
            font-weight: bold;
            color: #FF9800;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }
        
        .reward-validator {
            font-size: 0.9em;
            color: #666;
            margin-top: 4px;
        }
        
        .reward-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-reward {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-reward:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }
        
        .btn-reward:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .total-rewards {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #4CAF50;
            text-align: center;
            margin: 10px 0;
        }
        
        .total-rewards .amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #4CAF50;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .wallet-actions,
            .validator-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ FeiCoin åŒºå—é“¾æµè§ˆå™¨</h1>
            <p>çœŸå®åŒºå—é“¾æµè§ˆå™¨ - è¿æ¥ FeiCoin ç½‘ç»œï¼Œæ‰§è¡ŒçœŸå®è½¬è´¦äº¤æ˜“</p>
        </div>

        <div class="main-content">
            <!-- å·¦ä¾§ï¼šæ“ä½œé¢æ¿ -->
            <div class="operations-panel">
                <!-- åŒºå—é“¾çŠ¶æ€ -->
                <div class="section">
                    <h2>â›“ï¸ åŒºå—é“¾çŠ¶æ€</h2>
                    <div class="blockchain-info">
                        <div class="info-card">
                            <h4>å½“å‰é«˜åº¦</h4>
                            <div class="value" id="block-height">-</div>
                        </div>
                        <div class="info-card">
                            <h4>éªŒè¯è€…æ•°é‡</h4>
                            <div class="value" id="validator-count">-</div>
                        </div>
                        <div class="info-card">
                            <h4>ç½‘ç»œID</h4>
                            <div class="value" id="chain-id">-</div>
                        </div>
                        <div class="info-card">
                            <h4>æœ€æ–°åŒºå—æ—¶é—´</h4>
                            <div class="value" id="block-time" style="font-size: 1em;">-</div>
                        </div>
                    </div>
                </div>

                <!-- è½¬è´¦ä¸é’±åŒ…ç®¡ç†èåˆ -->
                <div class="section">
                    <h2>ğŸ’¸ è½¬è´¦ & é’±åŒ…ç®¡ç†</h2>
                    
                    <!-- é’±åŒ…ä½™é¢æ˜¾ç¤º -->
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h3 style="font-size: 1.1em; margin: 0; color: #333;">ğŸ’° è´¦æˆ·ä½™é¢</h3>
                            <div>
                                <button class="btn-mini" onclick="refreshWalletList()">ğŸ”„</button>
                                <button class="btn-mini" onclick="showCreateWallet()">+</button>
                                <button class="btn-mini" onclick="showImportWallet()">ğŸ“¥</button>
                            </div>
                        </div>
                        <div class="wallets-container-horizontal" id="wallets-container">
                            åŠ è½½ä¸­...
                        </div>
                    </div>
                    
                    <!-- è½¬è´¦è¡¨å• -->
                    <div class="transfer-form">
                        <div class="form-row">
                            <div class="form-group" style="flex: 1; margin-right: 10px;">
                                <label for="from-account">ä»è´¦æˆ·:</label>
                                <select id="from-account">
                                    <option value="alice">Alice (feic1kpyhmumrt5g0veex9lhpzh3m99rptmmuz7cq8u)</option>
                                    <option value="bob">Bob (feic1kfde52eamxnnwkn2yjv9uj5xuf0amxuh70tnpw)</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="to-account">åˆ°è´¦æˆ·:</label>
                                <select id="to-account">
                                    <option value="bob">Bob (feic1kfde52eamxnnwkn2yjv9uj5xuf0amxuh70tnpw)</option>
                                    <option value="alice">Alice (feic1kpyhmumrt5g0veex9lhpzh3m99rptmmuz7cq8u)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2; margin-right: 10px;">
                                <label for="amount">è½¬è´¦é‡‘é¢:</label>
                                <input type="number" id="amount" placeholder="è¾“å…¥è½¬è´¦é‡‘é¢" min="1">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="denom">ä»£å¸ç±»å‹:</label>
                                <select id="denom">
                                    <option value="token">token</option>
                                    <option value="stake">stake</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="sendTransfer()" id="transfer-btn">ğŸ’³ å‘èµ·è½¬è´¦</button>
                    </div>
                    <div id="transfer-status"></div>
                    
                    <!-- é’±åŒ…åˆ›å»º/å¯¼å…¥è¡¨å• -->
                    <div id="create-wallet-form" class="wallet-form" style="display: none;">
                        <h3>åˆ›å»ºæ–°é’±åŒ…</h3>
                        <div class="form-group">
                            <label for="new-wallet-name">é’±åŒ…åç§°:</label>
                            <input type="text" id="new-wallet-name" placeholder="è¾“å…¥é’±åŒ…åç§°">
                        </div>
                        <button class="btn" onclick="createWallet()">ğŸ”‘ åˆ›å»ºé’±åŒ…</button>
                        <button class="btn" onclick="hideWalletForms()">âŒ å–æ¶ˆ</button>
                    </div>
                    
                    <div id="import-wallet-form" class="wallet-form" style="display: none;">
                        <h3>å¯¼å…¥é’±åŒ…</h3>
                        <div class="form-group">
                            <label for="import-wallet-name">é’±åŒ…åç§°:</label>
                            <input type="text" id="import-wallet-name" placeholder="è¾“å…¥é’±åŒ…åç§°">
                        </div>
                        <div class="form-group">
                            <label for="wallet-mnemonic">åŠ©è®°è¯:</label>
                            <textarea id="wallet-mnemonic" placeholder="è¾“å…¥12æˆ–24ä¸ªåŠ©è®°è¯ï¼Œç”¨ç©ºæ ¼åˆ†éš”" rows="3"></textarea>
                        </div>
                        <button class="btn" onclick="importWallet()">ğŸ“¥ å¯¼å…¥é’±åŒ…</button>
                        <button class="btn" onclick="hideWalletForms()">âŒ å–æ¶ˆ</button>
                    </div>
                </div>


                <!-- éªŒè¯è€…ç®¡ç† -->
                <div class="section">
                    <h2>âš¡ éªŒè¯è€…ç®¡ç†</h2>
                    <div class="validator-management">
                        <div class="validator-actions">
                            <button class="btn" onclick="refreshValidatorList()">ğŸ”„ åˆ·æ–°éªŒè¯è€…</button>
                            <button class="btn" onclick="showCreateValidator()">â• åˆ›å»ºéªŒè¯è€…</button>
                            <button class="btn" onclick="showDelegateForm()">ğŸ¤ å§”æ‰˜è´¨æŠ¼</button>
                        </div>
                        
                        <!-- åˆ›å»ºéªŒè¯è€…è¡¨å• -->
                        <div id="create-validator-form" class="validator-form" style="display: none;">
                            <h3>åˆ›å»ºéªŒè¯è€…</h3>
                            <div class="form-group">
                                <label for="validator-account">è´¦æˆ·:</label>
                                <select id="validator-account">
                                    <option value="">é€‰æ‹©è´¦æˆ·</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="validator-amount">è´¨æŠ¼é‡‘é¢:</label>
                                <input type="number" id="validator-amount" placeholder="è´¨æŠ¼é‡‘é¢" min="1000000">
                            </div>
                            <div class="form-group">
                                <label for="validator-moniker">éªŒè¯è€…åç§°:</label>
                                <input type="text" id="validator-moniker" placeholder="éªŒè¯è€…æ˜¾ç¤ºåç§°">
                            </div>
                            <div class="form-group">
                                <label for="validator-commission">ä½£é‡‘ç‡ (%):</label>
                                <input type="number" id="validator-commission" placeholder="10" min="0" max="100" step="0.01">
                            </div>
                            <button class="btn" onclick="createValidator()">âš¡ åˆ›å»ºéªŒè¯è€…</button>
                            <button class="btn" onclick="hideValidatorForms()">âŒ å–æ¶ˆ</button>
                        </div>
                        
                        <!-- å§”æ‰˜è¡¨å• -->
                        <div id="delegate-form" class="validator-form" style="display: none;">
                            <h3>å§”æ‰˜è´¨æŠ¼</h3>
                            <div class="form-group">
                                <label for="delegate-account">è´¦æˆ·:</label>
                                <select id="delegate-account">
                                    <option value="">é€‰æ‹©è´¦æˆ·</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="delegate-validator">éªŒè¯è€…:</label>
                                <select id="delegate-validator">
                                    <option value="">é€‰æ‹©éªŒè¯è€…</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="delegate-amount">å§”æ‰˜é‡‘é¢:</label>
                                <input type="number" id="delegate-amount" placeholder="å§”æ‰˜é‡‘é¢" min="1">
                            </div>
                            <button class="btn" onclick="delegateStake()">ğŸ¤ å§”æ‰˜è´¨æŠ¼</button>
                            <button class="btn" onclick="hideValidatorForms()">âŒ å–æ¶ˆ</button>
                        </div>
                        
                        <!-- éªŒè¯è€…åˆ—è¡¨ -->
                        <div class="validator-list" id="validator-list">
                            <h3>éªŒè¯è€…åˆ—è¡¨</h3>
                            <div id="validators-container">åŠ è½½ä¸­...</div>
                        </div>
                        
                        <!-- å¥–åŠ±ç®¡ç† -->
                        <div class="rewards-management">
                            <div class="rewards-container">
                                <div class="rewards-header">
                                    <h3>ğŸ† å¥–åŠ±ç®¡ç†</h3>
                                    <button class="btn-mini" onclick="refreshRewards()" title="åˆ·æ–°å¥–åŠ±">ğŸ”„</button>
                                </div>
                                
                                <!-- æ€»å¥–åŠ±ç»Ÿè®¡ -->
                                <div class="total-rewards" id="total-rewards">
                                    <div>æ€»è®¡æœªæå–å¥–åŠ±</div>
                                    <div class="amount" id="total-reward-amount">åŠ è½½ä¸­...</div>
                                </div>
                                
                                <!-- å¥–åŠ±è¯¦æƒ…åˆ—è¡¨ -->
                                <div id="rewards-list">
                                    åŠ è½½ä¸­...
                                </div>
                                
                                <!-- æ‰¹é‡æ“ä½œ -->
                                <div style="text-align: center; margin-top: 15px;">
                                    <button class="btn-reward" onclick="withdrawAllRewards()" id="withdraw-all-btn">
                                        ğŸ’° æå–æ‰€æœ‰å¥–åŠ±
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ—¥å¿—é¢æ¿ -->
            <div class="logs-panel">
                <div class="section">
                    <h2>ğŸ“‹ åŒºå—é“¾æ‰§è¡Œæ—¥å¿—</h2>
                    <div style="margin-bottom: 15px;">
                        <button class="btn" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
                        <button class="btn" onclick="toggleAutoRefresh()">
                            <span id="auto-refresh-text">â¸ï¸ åœæ­¢è‡ªåŠ¨åˆ·æ–°</span>
                        </button>
                    </div>
                    <div class="logs" id="blockchain-logs">
                        <div class="log-entry">
                            <span class="log-timestamp">[ç³»ç»Ÿå¯åŠ¨]</span>
                            <span class="log-level-info">[INFO]</span> ğŸ¯ åŒºå—é“¾æµè§ˆå™¨å·²åŠ è½½ï¼Œç­‰å¾…è¿æ¥åŒºå—é“¾ç½‘ç»œ...
                        </div>
                        <div class="log-entry" style="color: #666; font-style: italic;">
                            <span class="log-timestamp">[ä½¿ç”¨æç¤º]</span>
                            ğŸ’¡ è½¬è´¦æ—¥å¿—å°†ä»¥è“è‰²é«˜äº®æ˜¾ç¤ºï¼ŒæˆåŠŸæ“ä½œä»¥ç»¿è‰²æ˜¾ç¤º
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è´¦æˆ·åœ°å€æ˜ å°„ (åŠ¨æ€æ›´æ–°)
        let accounts = {
            alice: 'feic1kpyhmumrt5g0veex9lhpzh3m99rptmmuz7cq8u',
            bob: 'feic1kfde52eamxnnwkn2yjv9uj5xuf0amxuh70tnpw'
        };
        
        let allWallets = [];
        let allValidators = [];

        // è·å–è´¦æˆ·åœ°å€çš„é€šç”¨å‡½æ•°
        function getAccountAddress(accountName) {
            // é¦–å…ˆæ£€æŸ¥é™æ€æ˜ å°„
            if (accounts[accountName]) {
                return accounts[accountName];
            }
            
            // ç„¶åæ£€æŸ¥åŠ¨æ€é’±åŒ…åˆ—è¡¨
            const wallet = allWallets.find(w => w.name === accountName);
            if (wallet) {
                return wallet.address;
            }
            
            // å¦‚æœå·²ç»æ˜¯åœ°å€æ ¼å¼ï¼Œç›´æ¥è¿”å›
            if (accountName && accountName.startsWith('feic1')) {
                return accountName;
            }
            
            console.error(`æ— æ³•æ‰¾åˆ°è´¦æˆ· ${accountName} çš„åœ°å€`);
            return null;
        }

        let autoRefreshInterval;
        let isAutoRefreshing = true;

        // æ·»åŠ æ—¥å¿—å‡½æ•°
        function addLog(level, message) {
            const logs = document.getElementById('blockchain-logs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span> ${message}
            `;
            logs.insertBefore(logEntry, logs.firstChild);
            
            // ä¿æŒæœ€æ–°çš„100æ¡æ—¥å¿—
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        // æ·»åŠ è½¬è´¦ä¸“ç”¨æ—¥å¿—å‡½æ•°
        function addTransferLog(level, message) {
            const logs = document.getElementById('blockchain-logs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry transfer-log`;
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span> ${message}
            `;
            logs.insertBefore(logEntry, logs.firstChild);
            
            // ä¿æŒæœ€æ–°çš„100æ¡æ—¥å¿—
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        // æ·»åŠ æˆåŠŸæ—¥å¿—å‡½æ•°
        function addSuccessLog(message) {
            const logs = document.getElementById('blockchain-logs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry success-log`;
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-success">[SUCCESS]</span> ${message}
            `;
            logs.insertBefore(logEntry, logs.firstChild);
            
            // ä¿æŒæœ€æ–°çš„100æ¡æ—¥å¿—
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        // æ·»åŠ åˆ†å‰²çº¿
        function addTransferSeparator() {
            const logs = document.getElementById('blockchain-logs');
            const separator = document.createElement('div');
            separator.className = 'transfer-separator';
            logs.insertBefore(separator, logs.firstChild);
        }

        // æ·»åŠ è½¬è´¦ç»“æŸåˆ†å‰²çº¿
        function addTransferEndSeparator() {
            const logs = document.getElementById('blockchain-logs');
            const separator = document.createElement('div');
            separator.className = 'transfer-end-separator';
            logs.insertBefore(separator, logs.firstChild);
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('transfer-status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 5000);
            }
        }

        // è·å–ä½™é¢ - æ”¯æŒè´¦æˆ·åå’Œåœ°å€
        async function getBalance(account) {
            try {
                // å¦‚æœæ˜¯åœ°å€ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœæ˜¯è´¦æˆ·ååˆ™ä»accountsæŸ¥æ‰¾
                let address = account;
                if (accounts[account]) {
                    address = accounts[account];
                } else if (!account.startsWith('feic1')) {
                    // å¦‚æœä¸æ˜¯åœ°å€ä¹Ÿä¸åœ¨accountsä¸­ï¼Œå°è¯•ä»allWalletsæŸ¥æ‰¾
                    const wallet = allWallets.find(w => w.name === account);
                    if (wallet) {
                        address = wallet.address;
                    }
                }
                
                const response = await fetch(`http://localhost:1317/cosmos/bank/v1beta1/balances/${address}`);
                const data = await response.json();
                return data.balances;
            } catch (error) {
                addLog('error', `è·å–${account}ä½™é¢å¤±è´¥: ${error.message}`);
                return [];
            }
        }

        // åˆ·æ–°ä½™é¢æ˜¾ç¤º - ç°åœ¨æ›´æ–°é’±åŒ…åˆ—è¡¨ä¸­çš„ä½™é¢
        async function refreshBalances() {
            addLog('info', 'æ­£åœ¨åˆ·æ–°è´¦æˆ·ä½™é¢...');
            
            // å¦‚æœé’±åŒ…åˆ—è¡¨å·²åŠ è½½ï¼Œåˆ™åˆ·æ–°é’±åŒ…ä½™é¢æ˜¾ç¤º
            if (allWallets.length > 0) {
                for (const wallet of allWallets) {
                    try {
                        const balance = await getBalance(wallet.address);
                        const balanceElement = document.getElementById(`balance-${wallet.name}`);
                        if (balanceElement && balance.length > 0) {
                            const balanceHtml = balance.map(b => 
                                `${parseInt(b.amount).toLocaleString()} ${b.denom}`
                            ).join('<br>');
                            balanceElement.innerHTML = balanceHtml;
                        } else if (balanceElement) {
                            balanceElement.innerHTML = '0';
                        }
                    } catch (error) {
                        console.error(`åˆ·æ–°${wallet.name}ä½™é¢å¤±è´¥:`, error);
                    }
                }
            }
            
            addLog('info', 'é’±åŒ…ä½™é¢å·²æ›´æ–°');
        }

        // è·å–åŒºå—é“¾çŠ¶æ€
        async function getBlockchainStatus() {
            try {
                // è·å–æœ€æ–°åŒºå—ä¿¡æ¯
                const blockResponse = await fetch('http://localhost:1317/cosmos/base/tendermint/v1beta1/blocks/latest');
                const blockData = await blockResponse.json();
                
                // è·å–èŠ‚ç‚¹ä¿¡æ¯
                const nodeResponse = await fetch('http://localhost:1317/cosmos/base/tendermint/v1beta1/node_info');
                const nodeData = await nodeResponse.json();
                
                // è·å–éªŒè¯è€…ä¿¡æ¯
                const validatorResponse = await fetch('http://localhost:1317/cosmos/staking/v1beta1/validators');
                const validatorData = await validatorResponse.json();
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('block-height').textContent = blockData.block.header.height;
                document.getElementById('validator-count').textContent = validatorData.validators.length;
                document.getElementById('chain-id').textContent = nodeData.default_node_info.network;
                document.getElementById('block-time').textContent = new Date(blockData.block.header.time).toLocaleTimeString();
                
                addLog('info', `åŒºå— #${blockData.block.header.height} å·²ç¡®è®¤ï¼ŒåŒ…å« ${blockData.block.data.txs ? blockData.block.data.txs.length : 0} ç¬”äº¤æ˜“`);
            } catch (error) {
                addLog('error', `è·å–åŒºå—é“¾çŠ¶æ€å¤±è´¥: ${error.message}`);
            }
        }

        // çœŸå®è½¬è´¦åŠŸèƒ½ - ä½¿ç”¨ CLI å‘½ä»¤æ‰§è¡Œå®é™…è½¬è´¦
        async function sendTransfer() {
            const fromAccount = document.getElementById('from-account').value;
            const toAccount = document.getElementById('to-account').value;
            const amount = document.getElementById('amount').value;
            const denom = document.getElementById('denom').value;

            if (!amount || amount <= 0) {
                showStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„è½¬è´¦é‡‘é¢', 'error');
                return;
            }

            if (fromAccount === toAccount) {
                showStatus('ä¸èƒ½å‘è‡ªå·±è½¬è´¦', 'error');
                return;
            }

            // éªŒè¯è´¦æˆ·åœ°å€
            const fromAddress = getAccountAddress(fromAccount);
            const toAddress = getAccountAddress(toAccount);
            
            if (!fromAddress) {
                showStatus(`æ— æ³•æ‰¾åˆ°å‘é€è´¦æˆ· ${fromAccount} çš„åœ°å€`, 'error');
                return;
            }
            
            if (!toAddress) {
                showStatus(`æ— æ³•æ‰¾åˆ°æ¥æ”¶è´¦æˆ· ${toAccount} çš„åœ°å€`, 'error');
                return;
            }

            // ç¦ç”¨æŒ‰é’®
            document.getElementById('transfer-btn').disabled = true;
            showStatus(`æ­£åœ¨å¤„ç†ä» ${fromAccount} åˆ° ${toAccount} çš„ ${amount} ${denom} è½¬è´¦...`, 'loading');
            
            // æ·»åŠ è½¬è´¦å¼€å§‹åˆ†å‰²çº¿
            addTransferSeparator();
            
            addTransferLog('transfer', `ğŸš€ çœŸå®è½¬è´¦äº¤æ˜“å¼€å§‹ï¼`);
            addTransferLog('transfer', `ğŸ“¤ å‘é€æ–¹: ${fromAccount.toUpperCase()} â†’ ${getAccountAddress(fromAccount)}`);
            addTransferLog('transfer', `ğŸ“¥ æ¥æ”¶æ–¹: ${toAccount.toUpperCase()} â†’ ${getAccountAddress(toAccount)}`);
            addTransferLog('transfer', `ğŸ’° è½¬è´¦é‡‘é¢: ${parseInt(amount).toLocaleString()} ${denom.toUpperCase()}`);
            
            try {
                addTransferLog('transfer', 'ğŸ” ç¬¬1æ­¥ï¼šéªŒè¯è´¦æˆ·ä½™é¢...');
                
                // æ£€æŸ¥å‘é€æ–¹ä½™é¢
                const senderBalance = await getBalance(fromAccount);
                const tokenBalance = senderBalance.find(b => b.denom === denom);
                
                if (!tokenBalance || parseInt(tokenBalance.amount) < parseInt(amount)) {
                    throw new Error(`ä½™é¢ä¸è¶³ã€‚éœ€è¦ ${amount} ${denom}ï¼Œä½†åªæœ‰ ${tokenBalance ? tokenBalance.amount : 0} ${denom}`);
                }
                
                addTransferLog('transfer', 'âœ… ä½™é¢éªŒè¯é€šè¿‡ - è´¦æˆ·èµ„é‡‘å……è¶³');
                addTransferLog('transfer', 'ğŸ” ç¬¬2æ­¥ï¼šé€šè¿‡è½¬è´¦æœåŠ¡å™¨æ‰§è¡Œäº¤æ˜“...');
                
                try {
                    const response = await fetch('http://localhost:3001/transfer', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            fromAccount: fromAccount,
                            toAccount: getAccountAddress(toAccount),
                            amount: amount,
                            denom: denom
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        addTransferLog('transfer', 'âœ… è½¬è´¦å‘½ä»¤æ‰§è¡ŒæˆåŠŸ');
                        addTransferLog('transfer', 'ğŸ“¡ ç¬¬3æ­¥ï¼šäº¤æ˜“å·²å¹¿æ’­åˆ°åŒºå—é“¾ç½‘ç»œ...');
                        
                        // ä»è¿”å›ç»“æœä¸­æå–äº¤æ˜“å“ˆå¸Œ
                        const txHashMatch = result.output.match(/txhash: ([A-F0-9]+)/);
                        const txHash = txHashMatch ? txHashMatch[1] : null;
                        
                        if (txHash) {
                            addTransferLog('transfer', `ğŸ“‹ äº¤æ˜“å“ˆå¸Œ: ${txHash}`);
                            addTransferLog('transfer', 'â›“ï¸ ç¬¬4æ­¥ï¼šç­‰å¾…åŒºå—é“¾ç½‘ç»œç¡®è®¤äº¤æ˜“...');
                            addTransferLog('transfer', 'ğŸ” å¼€å§‹ç›‘æ§äº¤æ˜“çŠ¶æ€...');
                            
                            // çœŸæ­£ç­‰å¾…åŒºå—ç¡®è®¤
                            let confirmed = false;
                            let attempts = 0;
                            const maxAttempts = 30; // æœ€å¤šç­‰å¾…30æ¬¡ï¼Œæ¯æ¬¡2ç§’
                            
                            while (!confirmed && attempts < maxAttempts) {
                                attempts++;
                                await new Promise(resolve => setTimeout(resolve, 2000));
                                
                                try {
                                    addTransferLog('transfer', `ğŸ”„ ç¬¬${attempts}æ¬¡æŸ¥è¯¢: æ£€æŸ¥äº¤æ˜“æ˜¯å¦è¢«æ‰“åŒ…åˆ°åŒºå—ä¸­...`);
                                    
                                    // æŸ¥è¯¢äº¤æ˜“çŠ¶æ€
                                    const txResponse = await fetch(`http://localhost:1317/cosmos/tx/v1beta1/txs/${txHash}`);
                                    
                                    if (txResponse.ok) {
                                        const txData = await txResponse.json();
                                        
                                        if (txData.tx_response) {
                                            const currentHeight = txData.tx_response.height;
                                            
                                            if (currentHeight === "0") {
                                                addTransferLog('transfer', `â³ äº¤æ˜“è¿˜åœ¨å†…å­˜æ± ä¸­ï¼Œç­‰å¾…éªŒè¯è€…æ‰“åŒ…...`);
                                                
                                                // æ˜¾ç¤ºç­‰å¾…è¿›åº¦
                                                const progress = Math.round((attempts / maxAttempts) * 100);
                                                addTransferLog('transfer', `ğŸ“Š ç­‰å¾…è¿›åº¦: ${progress}% (${attempts}/${maxAttempts})`);
                                            } else {
                                                confirmed = true;
                                                addTransferLog('transfer', `ğŸ‰ äº¤æ˜“æˆåŠŸæ‰“åŒ…ï¼åŒºå—é«˜åº¦: #${currentHeight}`);
                                                addTransferLog('transfer', `âœ… éªŒè¯è€…èŠ‚ç‚¹å·²éªŒè¯å¹¶ç¡®è®¤äº¤æ˜“`);
                                                addTransferLog('transfer', `ğŸ“¦ äº¤æ˜“å·²æ°¸ä¹…è®°å½•åœ¨åŒºå—é“¾ä¸Š`);
                                                addTransferLog('transfer', `â›½ Gas æ¶ˆè€—: ${txData.tx_response.gas_used}/${txData.tx_response.gas_wanted}`);
                                                
                                                // æ˜¾ç¤ºæ‰‹ç»­è´¹ä¿¡æ¯
                                                if (txData.tx && txData.tx.auth_info && txData.tx.auth_info.fee) {
                                                    const fee = txData.tx.auth_info.fee;
                                                    if (fee.amount && fee.amount.length > 0) {
                                                        const feeAmount = fee.amount.map(f => `${f.amount} ${f.denom}`).join(', ');
                                                        addTransferLog('transfer', `ğŸ’³ å®é™…æ‰‹ç»­è´¹: ${feeAmount}`);
                                                    } else {
                                                        addTransferLog('transfer', `ğŸ’³ å®é™…æ‰‹ç»­è´¹: å…è´¹äº¤æ˜“ (Gas Price = 0)`);
                                                    }
                                                } else {
                                                    addTransferLog('transfer', `ğŸ’³ æ‰‹ç»­è´¹ä¿¡æ¯: æœªè®¾ç½®æˆ–å…è´¹ç½‘ç»œ`);
                                                }
                                                
                                                addTransferLog('transfer', `ğŸ“… åŒºå—ç¡®è®¤æ—¶é—´: ${new Date(txData.tx_response.timestamp).toLocaleString()}`);
                                                
                                                // æ˜¾ç¤ºäº¤æ˜“è¯¦æƒ…
                                                if (txData.tx_response.events) {
                                                    const transferEvent = txData.tx_response.events.find(e => e.type === 'transfer');
                                                    if (transferEvent) {
                                                        const amountAttr = transferEvent.attributes.find(a => a.key === 'amount');
                                                        if (amountAttr) {
                                                            addTransferLog('transfer', `ğŸ’° é“¾ä¸Šç¡®è®¤é‡‘é¢: ${amountAttr.value}`);
                                                        }
                                                    }
                                                }
                                                break;
                                            }
                                        } else {
                                            addTransferLog('transfer', `âš ï¸ äº¤æ˜“æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œç»§ç»­ç­‰å¾…...`);
                                        }
                                    } else {
                                        addTransferLog('transfer', `ğŸ” äº¤æ˜“è¿˜æœªè¢«ç½‘ç»œæ¥æ”¶ï¼Œç»§ç»­ç›‘æ§...`);
                                    }
                                } catch (queryError) {
                                    addTransferLog('transfer', `âš ï¸ ç½‘ç»œæŸ¥è¯¢å¤±è´¥: ${queryError.message}`);
                                    addTransferLog('transfer', `ğŸ”„ å°†åœ¨2ç§’åé‡è¯•...`);
                                }
                            }
                            
                            if (!confirmed) {
                                addTransferLog('transfer', 'â° è¶…æ—¶ï¼šæœªèƒ½åœ¨é¢„æœŸæ—¶é—´å†…ç¡®è®¤ï¼Œä½†äº¤æ˜“å¯èƒ½ä»åœ¨å¤„ç†ä¸­');
                            }
                        } else {
                            addTransferLog('transfer', 'âš ï¸ æœªèƒ½è·å–äº¤æ˜“å“ˆå¸Œï¼Œä½¿ç”¨å¤‡ç”¨ç¡®è®¤æ–¹å¼');
                            await new Promise(resolve => setTimeout(resolve, 5000));
                        }
                        
                        addTransferLog('transfer', 'ğŸ” ç¬¬5æ­¥ï¼šéªŒè¯äº¤æ˜“ç»“æœ...');
                        
                        // æ£€æŸ¥ä½™é¢å˜åŒ–
                        const newSenderBalance = await getBalance(fromAccount);
                        const newReceiverBalance = await getBalance(toAccount);
                        
                        const newSenderTokenBalance = newSenderBalance.find(b => b.denom === denom);
                        const newReceiverTokenBalance = newReceiverBalance.find(b => b.denom === denom);
                        
                        // æ¯”è¾ƒä½™é¢å˜åŒ–
                        const oldSenderAmount = parseInt(tokenBalance.amount);
                        const newSenderAmount = newSenderTokenBalance ? parseInt(newSenderTokenBalance.amount) : 0;
                        
                        if (newSenderAmount < oldSenderAmount) {
                            addSuccessLog('ğŸ‰ è½¬è´¦æˆåŠŸï¼äº¤æ˜“å·²åœ¨åŒºå—é“¾ä¸Šç¡®è®¤');
                            addSuccessLog(`ğŸ’¸ ${fromAccount.toUpperCase()} ä½™é¢å‡å°‘ ${oldSenderAmount - newSenderAmount} ${denom}`);
                            addSuccessLog(`ğŸ’° ${toAccount.toUpperCase()} å½“å‰ä½™é¢: ${newReceiverTokenBalance ? parseInt(newReceiverTokenBalance.amount).toLocaleString() : 0} ${denom}`);
                            addSuccessLog('ğŸ“Š çœŸå®åŒºå—é“¾äº¤æ˜“å®Œæˆ');
                            showStatus(`ğŸ‰ è½¬è´¦æˆåŠŸï¼ä» ${fromAccount} å‘ ${toAccount} è½¬è´¦ ${amount} ${denom}`, 'success');
                        } else {
                            addTransferLog('transfer', 'âš ï¸ ä½™é¢æœªå˜åŒ–ï¼Œå¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´ç¡®è®¤');
                            showStatus('è½¬è´¦å·²æäº¤ï¼Œè¯·ç¨åæŸ¥çœ‹ä½™é¢å˜åŒ–', 'success');
                        }
                        
                        // æ·»åŠ è½¬è´¦ç»“æŸåˆ†å‰²çº¿
                        addTransferEndSeparator();
                        
                        // åˆ·æ–°ä½™é¢æ˜¾ç¤º
                        refreshBalances();
                        
                    } else {
                        throw new Error(result.error || 'è½¬è´¦æœåŠ¡å™¨è¿”å›é”™è¯¯');
                    }
                    
                } catch (transferError) {
                    addTransferLog('transfer', 'âŒ è‡ªåŠ¨è½¬è´¦å¤±è´¥ï¼Œå°è¯•æ‰‹åŠ¨æ–¹å¼...');
                    addTransferLog('transfer', `é”™è¯¯ä¿¡æ¯: ${transferError.message}`);
                    
                    // æä¾›æ‰‹åŠ¨å‘½ä»¤ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
                    const toAddress = getAccountAddress(toAccount);
                    if (toAddress) {
                        const transferCommand = `/Users/ggbond/go/bin/feicoind tx bank send ${fromAccount} ${toAddress} ${amount}${denom} --from ${fromAccount} --keyring-backend test --chain-id feicoin --yes --node http://localhost:26657`;
                        addTransferLog('transfer', 'ğŸ“‹ è¯·åœ¨ç»ˆç«¯æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:');
                        addTransferLog('transfer', `ğŸ”§ ${transferCommand}`);
                    } else {
                        addTransferLog('transfer', 'âŒ æ— æ³•ç”Ÿæˆæ‰‹åŠ¨å‘½ä»¤ï¼šç›®æ ‡è´¦æˆ·åœ°å€æ— æ•ˆ');
                    }
                    
                    // 10ç§’åæ£€æŸ¥ä½™é¢å˜åŒ–
                    setTimeout(async () => {
                        refreshBalances();
                        addTransferLog('transfer', 'ğŸ”„ å·²åˆ·æ–°ä½™é¢ï¼Œå¦‚æœ‰å˜åŒ–åˆ™è¡¨ç¤ºè½¬è´¦æˆåŠŸ');
                        addTransferEndSeparator();
                    }, 10000);
                    
                    showStatus('è‡ªåŠ¨è½¬è´¦å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ä¸­çš„æ‰‹åŠ¨å‘½ä»¤', 'error');
                }
                
            } catch (error) {
                addLog('error', `âŒ è½¬è´¦å¤±è´¥: ${error.message}`);
                addTransferEndSeparator();
                showStatus('è½¬è´¦å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè´¦æˆ·çŠ¶æ€', 'error');
                // é‡æ–°å¯ç”¨æŒ‰é’®
                document.getElementById('transfer-btn').disabled = false;
            }
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            document.getElementById('blockchain-logs').innerHTML = '';
            addLog('info', 'æ—¥å¿—å·²æ¸…é™¤');
        }

        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            const button = document.getElementById('auto-refresh-text');
            if (isAutoRefreshing) {
                clearInterval(autoRefreshInterval);
                isAutoRefreshing = false;
                button.textContent = 'â–¶ï¸ å¼€å§‹è‡ªåŠ¨åˆ·æ–°';
                addLog('info', 'è‡ªåŠ¨åˆ·æ–°å·²åœæ­¢');
            } else {
                startAutoRefresh();
                isAutoRefreshing = true;
                button.textContent = 'â¸ï¸ åœæ­¢è‡ªåŠ¨åˆ·æ–°';
                addLog('info', 'è‡ªåŠ¨åˆ·æ–°å·²å¯åŠ¨');
            }
        }

        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                refreshBalances();
                getBlockchainStatus();
            }, 5000); // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œä¸äº‹ä»¶ç›‘æ§åŒæ­¥
        }

        // çœŸå®åŒºå—é“¾äº‹ä»¶ç›‘æ§
        let lastBlockHeight = 0;
        function monitorBlockchainEvents() {
            setInterval(async () => {
                try {
                    // è·å–æœ€æ–°åŒºå—ä¿¡æ¯
                    const response = await fetch('http://localhost:1317/cosmos/base/tendermint/v1beta1/blocks/latest');
                    const data = await response.json();
                    const currentHeight = parseInt(data.block.header.height);
                    
                    // æ£€æµ‹æ–°åŒºå—
                    if (lastBlockHeight > 0 && currentHeight > lastBlockHeight) {
                        const newBlocks = currentHeight - lastBlockHeight;
                        if (newBlocks === 1) {
                            addLog('info', `â›“ï¸ æ–°åŒºå— #${currentHeight} å·²ç”Ÿæˆ`);
                        } else {
                            addLog('info', `â›“ï¸ æ£€æµ‹åˆ° ${newBlocks} ä¸ªæ–°åŒºå—ï¼Œå½“å‰é«˜åº¦: ${currentHeight}`);
                        }
                        
                        // æ£€æŸ¥åŒºå—ä¸­æ˜¯å¦æœ‰äº¤æ˜“
                        const txCount = data.block.data.txs ? data.block.data.txs.length : 0;
                        if (txCount > 0) {
                            addLog('info', `ğŸ“¦ åŒºå— #${currentHeight} åŒ…å« ${txCount} ç¬”äº¤æ˜“`);
                        }
                        
                        // åŒæ—¶æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„åŒºå—é«˜åº¦
                        document.getElementById('block-height').textContent = currentHeight;
                    }
                    
                    lastBlockHeight = currentHeight;
                } catch (error) {
                    // é™é»˜å¤„ç†é”™è¯¯ï¼Œé¿å…æ—¥å¿—å™ªéŸ³
                }
            }, 5000); // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡æ–°åŒºå—
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', async () => {
            addLog('info', 'ğŸš€ FeiCoin åŒºå—é“¾æµè§ˆå™¨å·²å¯åŠ¨');
            addLog('info', 'ğŸ”— æ­£åœ¨è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹...');
            
            try {
                await getBlockchainStatus();
                addLog('info', 'âœ… æˆåŠŸè¿æ¥åˆ°åŒºå—é“¾ç½‘ç»œ');
                
                // åˆå§‹åŒ–é’±åŒ…å’ŒéªŒè¯è€…åˆ—è¡¨
                await refreshWalletList();
                await refreshValidatorList();
                
                // åˆå§‹åŒ–å¥–åŠ±ç®¡ç†
                await refreshRewards();
                
                // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
                startAutoRefresh();
                
                // å¯åŠ¨çœŸå®åŒºå—é“¾äº‹ä»¶ç›‘æ§
                monitorBlockchainEvents();
                
            } catch (error) {
                addLog('error', `âŒ è¿æ¥å¤±è´¥: ${error.message}`);
                addLog('warning', 'è¯·ç¡®ä¿åŒºå—é“¾èŠ‚ç‚¹æ­£åœ¨è¿è¡Œ (ignite chain serve)');
            }
        });

        // ===========================================
        // é’±åŒ…ç®¡ç†åŠŸèƒ½
        // ===========================================

        // æ˜¾ç¤ºåˆ›å»ºé’±åŒ…è¡¨å•
        function showCreateWallet() {
            hideWalletForms();
            document.getElementById('create-wallet-form').style.display = 'block';
        }

        // æ˜¾ç¤ºå¯¼å…¥é’±åŒ…è¡¨å•
        function showImportWallet() {
            hideWalletForms();
            document.getElementById('import-wallet-form').style.display = 'block';
        }

        // éšè—æ‰€æœ‰é’±åŒ…è¡¨å•
        function hideWalletForms() {
            document.getElementById('create-wallet-form').style.display = 'none';
            document.getElementById('import-wallet-form').style.display = 'none';
        }

        // åˆ›å»ºæ–°é’±åŒ…
        async function createWallet() {
            const name = document.getElementById('new-wallet-name').value.trim();
            if (!name) {
                showStatus('è¯·è¾“å…¥é’±åŒ…åç§°', 'error');
                return;
            }

            try {
                addLog('info', `ğŸ”‘ æ­£åœ¨åˆ›å»ºé’±åŒ…: ${name}`);
                const response = await fetch('http://localhost:3001/wallet/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ é’±åŒ… "${name}" åˆ›å»ºæˆåŠŸ!`);
                    
                    // æ˜¾ç¤ºåŠ©è®°è¯
                    if (result.output && result.output.mnemonic) {
                        const mnemonicDiv = document.createElement('div');
                        mnemonicDiv.className = 'mnemonic-display';
                        mnemonicDiv.innerHTML = `
                            <div class="mnemonic-warning">âš ï¸ è¯·å®‰å…¨ä¿å­˜ä»¥ä¸‹åŠ©è®°è¯ï¼Œè¿™æ˜¯æ¢å¤é’±åŒ…çš„å”¯ä¸€æ–¹å¼ï¼</div>
                            <strong>åŠ©è®°è¯:</strong><br>${result.output.mnemonic}
                        `;
                        document.getElementById('create-wallet-form').appendChild(mnemonicDiv);
                    }
                    
                    document.getElementById('new-wallet-name').value = '';
                    setTimeout(() => {
                        hideWalletForms();
                        refreshWalletList();
                    }, 5000);
                } else {
                    addLog('error', `âŒ åˆ›å»ºé’±åŒ…å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ åˆ›å»ºé’±åŒ…å¤±è´¥: ${error.message}`);
            }
        }

        // å¯¼å…¥é’±åŒ…
        async function importWallet() {
            const name = document.getElementById('import-wallet-name').value.trim();
            const mnemonic = document.getElementById('wallet-mnemonic').value.trim();
            
            if (!name || !mnemonic) {
                showStatus('è¯·è¾“å…¥é’±åŒ…åç§°å’ŒåŠ©è®°è¯', 'error');
                return;
            }

            try {
                addLog('info', `ğŸ“¥ æ­£åœ¨å¯¼å…¥é’±åŒ…: ${name}`);
                const response = await fetch('http://localhost:3001/wallet/import', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, mnemonic: mnemonic })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ é’±åŒ… "${name}" å¯¼å…¥æˆåŠŸ!`);
                    document.getElementById('import-wallet-name').value = '';
                    document.getElementById('wallet-mnemonic').value = '';
                    hideWalletForms();
                    refreshWalletList();
                } else {
                    addLog('error', `âŒ å¯¼å…¥é’±åŒ…å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ å¯¼å…¥é’±åŒ…å¤±è´¥: ${error.message}`);
            }
        }

        // åˆ·æ–°é’±åŒ…åˆ—è¡¨
        async function refreshWalletList() {
            try {
                addLog('info', 'ğŸ”„ åˆ·æ–°é’±åŒ…åˆ—è¡¨...');
                const response = await fetch('http://localhost:3001/wallets/list');
                const result = await response.json();
                
                if (result.success) {
                    allWallets = result.output;
                    displayWallets();
                    updateAccountSelects();
                    addLog('info', `ğŸ“‹ è·å–åˆ° ${allWallets.length} ä¸ªé’±åŒ…`);
                } else {
                    addLog('error', `âŒ è·å–é’±åŒ…åˆ—è¡¨å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ è·å–é’±åŒ…åˆ—è¡¨å¤±è´¥: ${error.message}`);
            }
        }

        // æ˜¾ç¤ºé’±åŒ…åˆ—è¡¨ï¼ˆæ¨ªå‘ç´§å‡‘æ¨¡å¼ï¼‰
        async function displayWallets() {
            const container = document.getElementById('wallets-container');
            
            if (allWallets.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">æš‚æ— é’±åŒ…ï¼Œè¯·åˆ›å»ºæˆ–å¯¼å…¥é’±åŒ…</div>';
                return;
            }

            // å…ˆæ˜¾ç¤ºé’±åŒ…ç®€ä»‹ä¿¡æ¯ï¼Œç„¶åå¼‚æ­¥åŠ è½½ä½™é¢
            let html = '';
            for (const wallet of allWallets) {
                html += `
                    <div class="wallet-item-compact" id="wallet-${wallet.name}">
                        <div class="wallet-compact-name">ğŸ”‘ ${wallet.name}</div>
                        <div class="wallet-compact-balance" id="balance-${wallet.name}">åŠ è½½ä¸­...</div>
                        <div class="wallet-compact-actions-mini">
                            <button class="btn-mini" onclick="sendTokensToWallet('${wallet.address}')" title="å‘é€1000 token">ğŸ’°</button>
                            <button class="btn-mini" onclick="sendStakeToWallet('${wallet.address}')" title="å‘é€1000 stake">ğŸ¥©</button>
                            <button class="btn-mini" onclick="toggleWalletDetails('${wallet.name}')" title="æŸ¥çœ‹è¯¦æƒ…">ğŸ‘ï¸</button>
                        </div>
                        <div class="wallet-details" id="details-${wallet.name}">
                            <div><strong>å®Œæ•´åœ°å€:</strong></div>
                            <div class="wallet-address">${wallet.address}</div>
                            <div style="margin-top: 8px; text-align: center;">
                                <button class="btn btn-small" onclick="sendTokensToWallet('${wallet.address}')">ğŸ’° å‘é€ä»£å¸</button>
                            </div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
            
            // å¼‚æ­¥åŠ è½½æ¯ä¸ªé’±åŒ…çš„ä½™é¢
            for (const wallet of allWallets) {
                try {
                    const balance = await getBalance(wallet.address);
                    const balanceElement = document.getElementById(`balance-${wallet.name}`);
                    if (balanceElement && balance.length > 0) {
                        const balanceHtml = balance.map(b => 
                            `${parseInt(b.amount).toLocaleString()} ${b.denom}`
                        ).join('<br>');
                        balanceElement.innerHTML = balanceHtml;
                    } else if (balanceElement) {
                        balanceElement.innerHTML = '0';
                    }
                } catch (error) {
                    console.error(`åŠ è½½${wallet.name}ä½™é¢å¤±è´¥:`, error);
                    const balanceElement = document.getElementById(`balance-${wallet.name}`);
                    if (balanceElement) {
                        balanceElement.innerHTML = 'åŠ è½½å¤±è´¥';
                    }
                }
            }
        }

        // åˆ‡æ¢é’±åŒ…è¯¦æƒ…æ˜¾ç¤º
        function toggleWalletDetails(walletName) {
            const detailsElement = document.getElementById(`details-${walletName}`);
            const expandBtn = event.target;
            
            if (detailsElement.classList.contains('expanded')) {
                detailsElement.classList.remove('expanded');
                expandBtn.textContent = 'å±•å¼€è¯¦æƒ…';
            } else {
                // å…³é—­å…¶ä»–å·²å±•å¼€çš„è¯¦æƒ…
                document.querySelectorAll('.wallet-details.expanded').forEach(el => {
                    el.classList.remove('expanded');
                });
                document.querySelectorAll('.expand-btn').forEach(btn => {
                    btn.textContent = 'å±•å¼€è¯¦æƒ…';
                });
                
                // å±•å¼€å½“å‰é’±åŒ…è¯¦æƒ…
                detailsElement.classList.add('expanded');
                expandBtn.textContent = 'æ”¶èµ·è¯¦æƒ…';
            }
        }

        // å‘é€ä»£å¸åˆ°æ–°é’±åŒ…ï¼ˆæ°´é¾™å¤´åŠŸèƒ½ï¼‰
        async function sendTokensToWallet(address) {
            try {
                addLog('info', `ğŸ’° å‘ ${address} å‘é€ token...`);
                const response = await fetch('http://localhost:3001/wallet/send-tokens', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        toAccount: address,
                        amount: '1000',
                        denom: 'token'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ æˆåŠŸå‘é€ 1000 token åˆ°é’±åŒ…!`);
                    setTimeout(() => {
                        refreshWalletList();
                        refreshBalances();
                    }, 3000);
                } else {
                    addLog('error', `âŒ å‘é€ token å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ å‘é€ token å¤±è´¥: ${error.message}`);
            }
        }

        // å‘é€ stake åˆ°é’±åŒ…ï¼ˆè´¨æŠ¼ä»£å¸æ°´é¾™å¤´ï¼‰
        async function sendStakeToWallet(address) {
            try {
                addLog('info', `ğŸ¥© å‘ ${address} å‘é€ stake...`);
                const response = await fetch('http://localhost:3001/wallet/send-tokens', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        toAccount: address,
                        amount: '1000',
                        denom: 'stake'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ æˆåŠŸå‘é€ 1000 stake åˆ°é’±åŒ…!`);
                    addLog('info', `ğŸ“ ç°åœ¨å¯ä»¥ç”¨è¿™äº› stake è¿›è¡Œè´¨æŠ¼æˆ–åˆ›å»ºéªŒè¯è€…`);
                    setTimeout(() => {
                        refreshWalletList();
                        refreshBalances();
                    }, 3000);
                } else {
                    addLog('error', `âŒ å‘é€ stake å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ å‘é€ stake å¤±è´¥: ${error.message}`);
            }
        }

        // ===========================================
        // å¥–åŠ±ç®¡ç†åŠŸèƒ½
        // ===========================================
        
        let allRewards = [];
        
        // åˆ·æ–°å¥–åŠ±ä¿¡æ¯
        async function refreshRewards() {
            try {
                addLog('info', 'ğŸ”„ åˆ·æ–°å¥–åŠ±ä¿¡æ¯...');
                
                allRewards = [];
                let totalAmount = 0;
                
                // è·å–æ‰€æœ‰é’±åŒ…çš„å¥–åŠ±
                for (const wallet of allWallets) {
                    try {
                        const response = await fetch(`http://localhost:1317/cosmos/distribution/v1beta1/delegators/${wallet.address}/rewards`);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.rewards && data.rewards.length > 0) {
                                for (const reward of data.rewards) {
                                    if (reward.reward && reward.reward.length > 0) {
                                        const rewardInfo = {
                                            delegatorAddress: wallet.address,
                                            delegatorName: wallet.name,
                                            validatorAddress: reward.validator_address,
                                            rewards: reward.reward
                                        };
                                        allRewards.push(rewardInfo);
                                        
                                        // è®¡ç®—æ€»å¥–åŠ± (åªè®¡ç®— stake)
                                        for (const r of reward.reward) {
                                            if (r.denom === 'stake') {
                                                totalAmount += parseFloat(r.amount);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error(`è·å– ${wallet.name} å¥–åŠ±å¤±è´¥:`, error);
                    }
                }
                
                displayRewards();
                updateTotalRewards(totalAmount);
                addLog('info', `âœ… å¥–åŠ±ä¿¡æ¯å·²æ›´æ–°ï¼Œæ€»è®¡: ${(totalAmount/1000000).toFixed(6)} stake`);
                
            } catch (error) {
                addLog('error', `âŒ åˆ·æ–°å¥–åŠ±å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ˜¾ç¤ºå¥–åŠ±åˆ—è¡¨
        function displayRewards() {
            const container = document.getElementById('rewards-list');
            
            if (allRewards.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">æš‚æ— æœªæå–å¥–åŠ±</div>';
                return;
            }
            
            let html = '';
            for (const rewardInfo of allRewards) {
                // æ‰¾åˆ°å¯¹åº”çš„éªŒè¯è€…åç§°
                const validator = allValidators.find(v => v.operator_address === rewardInfo.validatorAddress);
                const validatorName = validator ? validator.description.moniker : 'æœªçŸ¥éªŒè¯è€…';
                
                // è®¡ç®—å¥–åŠ±é‡‘é¢
                const stakeReward = rewardInfo.rewards.find(r => r.denom === 'stake');
                const amount = stakeReward ? (parseFloat(stakeReward.amount) / 1000000).toFixed(6) : '0';
                
                if (parseFloat(amount) > 0.000001) { // åªæ˜¾ç¤ºæœ‰æ„ä¹‰çš„å¥–åŠ±
                    html += `
                        <div class="reward-item">
                            <div class="reward-info">
                                <div class="reward-amount">ğŸ’° ${amount} stake</div>
                                <div class="reward-validator">
                                    å§”æ‰˜è€…: ${rewardInfo.delegatorName} â†’ éªŒè¯è€…: ${validatorName}
                                </div>
                            </div>
                            <div class="reward-actions">
                                <button class="btn-reward" onclick="withdrawSpecificReward('${rewardInfo.delegatorAddress}', '${rewardInfo.validatorAddress}', '${rewardInfo.delegatorName}')">
                                    ğŸ’¸ æå–
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            if (html === '') {
                html = '<div style="text-align: center; padding: 20px; color: #666;">æ‰€æœ‰å¥–åŠ±é‡‘é¢å¤ªå°ï¼Œæš‚ä¸æ˜¾ç¤º</div>';
            }
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°æ€»å¥–åŠ±æ˜¾ç¤º
        function updateTotalRewards(totalAmount) {
            const totalDisplay = document.getElementById('total-reward-amount');
            const withdrawBtn = document.getElementById('withdraw-all-btn');
            
            const totalStake = (totalAmount / 1000000).toFixed(6);
            totalDisplay.textContent = `${totalStake} stake`;
            
            // å¦‚æœæ²¡æœ‰å¥–åŠ±ï¼Œç¦ç”¨æå–æŒ‰é’®
            if (parseFloat(totalStake) < 0.000001) {
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = 'ğŸ’° æš‚æ— å¥–åŠ±å¯æå–';
            } else {
                withdrawBtn.disabled = false;
                withdrawBtn.textContent = 'ğŸ’° æå–æ‰€æœ‰å¥–åŠ±';
            }
        }
        
        // æå–ç‰¹å®šå¥–åŠ±
        async function withdrawSpecificReward(delegatorAddress, validatorAddress, delegatorName) {
            try {
                addLog('info', `ğŸ† æ­£åœ¨ä¸º ${delegatorName} æå–å¥–åŠ±...`);
                
                const response = await fetch('http://localhost:3001/rewards/withdraw', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        delegatorAddress: delegatorAddress,
                        validatorAddress: validatorAddress,
                        fromAccount: delegatorName
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ ${delegatorName} å¥–åŠ±æå–æˆåŠŸ!`);
                    
                    // ç­‰å¾…å‡ ç§’ååˆ·æ–°
                    setTimeout(() => {
                        refreshRewards();
                        refreshWalletList();
                    }, 3000);
                } else {
                    addLog('error', `âŒ æå–å¥–åŠ±å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ æå–å¥–åŠ±å¤±è´¥: ${error.message}`);
            }
        }
        
        // æå–æ‰€æœ‰å¥–åŠ±
        async function withdrawAllRewards() {
            if (allRewards.length === 0) {
                addLog('warning', 'âš ï¸ æš‚æ— å¥–åŠ±å¯æå–');
                return;
            }
            
            addLog('info', 'ğŸš€ å¼€å§‹æ‰¹é‡æå–æ‰€æœ‰å¥–åŠ±...');
            
            let successCount = 0;
            let totalCount = 0;
            
            for (const rewardInfo of allRewards) {
                const stakeReward = rewardInfo.rewards.find(r => r.denom === 'stake');
                const amount = stakeReward ? parseFloat(stakeReward.amount) : 0;
                
                if (amount > 1000) { // åªæå–æœ‰æ„ä¹‰çš„å¥–åŠ±
                    totalCount++;
                    try {
                        const response = await fetch('http://localhost:3001/rewards/withdraw', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                delegatorAddress: rewardInfo.delegatorAddress,
                                validatorAddress: rewardInfo.validatorAddress,
                                fromAccount: rewardInfo.delegatorName
                            })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            successCount++;
                            addLog('info', `âœ… ${rewardInfo.delegatorName} å¥–åŠ±æå–æˆåŠŸ`);
                        } else {
                            addLog('error', `âŒ ${rewardInfo.delegatorName} å¥–åŠ±æå–å¤±è´¥: ${result.error}`);
                        }
                        
                        // é¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (error) {
                        addLog('error', `âŒ ${rewardInfo.delegatorName} å¥–åŠ±æå–å¼‚å¸¸: ${error.message}`);
                    }
                }
            }
            
            addSuccessLog(`ğŸŠ æ‰¹é‡æå–å®Œæˆ! æˆåŠŸ: ${successCount}/${totalCount}`);
            
            // ç­‰å¾…ååˆ·æ–°
            setTimeout(() => {
                refreshRewards();
                refreshWalletList();
            }, 3000);
        }

        // ===========================================
        // éªŒè¯è€…ç®¡ç†åŠŸèƒ½
        // ===========================================

        // æ˜¾ç¤ºåˆ›å»ºéªŒè¯è€…è¡¨å•
        function showCreateValidator() {
            hideValidatorForms();
            document.getElementById('create-validator-form').style.display = 'block';
            updateValidatorAccountOptions();
        }

        // æ˜¾ç¤ºå§”æ‰˜è¡¨å•
        function showDelegateForm() {
            hideValidatorForms();
            document.getElementById('delegate-form').style.display = 'block';
            updateValidatorAccountOptions();
            updateValidatorOptions();
        }

        // éšè—æ‰€æœ‰éªŒè¯è€…è¡¨å•
        function hideValidatorForms() {
            document.getElementById('create-validator-form').style.display = 'none';
            document.getElementById('delegate-form').style.display = 'none';
        }

        // åˆ›å»ºéªŒè¯è€…
        async function createValidator() {
            const fromAccount = document.getElementById('validator-account').value;
            const amount = document.getElementById('validator-amount').value;
            const moniker = document.getElementById('validator-moniker').value;
            const commission = document.getElementById('validator-commission').value;

            if (!fromAccount || !amount || !moniker || !commission) {
                showStatus('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                return;
            }

            try {
                addLog('info', `âš¡ æ­£åœ¨åˆ›å»ºéªŒè¯è€…: ${moniker}`);
                const response = await fetch('http://localhost:3001/validator/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAccount: fromAccount,
                        amount: amount,
                        moniker: moniker,
                        commissionRate: (parseFloat(commission) / 100).toString(),
                        maxCommissionRate: '0.20',
                        maxCommissionChangeRate: '0.01'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ éªŒè¯è€… "${moniker}" åˆ›å»ºæˆåŠŸ!`);
                    hideValidatorForms();
                    setTimeout(() => {
                        refreshValidatorList();
                        refreshBalances();
                    }, 5000);
                } else {
                    addLog('error', `âŒ åˆ›å»ºéªŒè¯è€…å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ åˆ›å»ºéªŒè¯è€…å¤±è´¥: ${error.message}`);
            }
        }

        // å§”æ‰˜è´¨æŠ¼
        async function delegateStake() {
            const fromAccount = document.getElementById('delegate-account').value;
            const validatorAddress = document.getElementById('delegate-validator').value;
            const amount = document.getElementById('delegate-amount').value;

            if (!fromAccount || !validatorAddress || !amount) {
                showStatus('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                return;
            }

            try {
                addLog('info', `ğŸ¤ æ­£åœ¨å§”æ‰˜è´¨æŠ¼ ${amount} stake...`);
                const response = await fetch('http://localhost:3001/validator/delegate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAccount: fromAccount,
                        validatorAddress: validatorAddress,
                        amount: amount
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`ğŸ‰ å§”æ‰˜è´¨æŠ¼æˆåŠŸ!`);
                    hideValidatorForms();
                    setTimeout(() => {
                        refreshValidatorList();
                        refreshBalances();
                    }, 3000);
                } else {
                    addLog('error', `âŒ å§”æ‰˜è´¨æŠ¼å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ å§”æ‰˜è´¨æŠ¼å¤±è´¥: ${error.message}`);
            }
        }

        // åˆ·æ–°éªŒè¯è€…åˆ—è¡¨
        async function refreshValidatorList() {
            try {
                addLog('info', 'ğŸ”„ åˆ·æ–°éªŒè¯è€…åˆ—è¡¨...');
                const response = await fetch('http://localhost:3001/validators/list');
                const result = await response.json();
                
                if (result.success) {
                    allValidators = result.output.validators;
                    displayValidators();
                    addLog('info', `ğŸ›ï¸ è·å–åˆ° ${allValidators.length} ä¸ªéªŒè¯è€…`);
                } else {
                    addLog('error', `âŒ è·å–éªŒè¯è€…åˆ—è¡¨å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `âŒ è·å–éªŒè¯è€…åˆ—è¡¨å¤±è´¥: ${error.message}`);
            }
        }

        // æ˜¾ç¤ºéªŒè¯è€…åˆ—è¡¨
        function displayValidators() {
            const container = document.getElementById('validators-container');
            
            if (allValidators.length === 0) {
                container.innerHTML = '<p>æš‚æ— éªŒè¯è€…</p>';
                return;
            }

            let html = '';
            for (const validator of allValidators) {
                const status = validator.status === 'BOND_STATUS_BONDED' ? 'bonded' : 'unbonded';
                const statusText = validator.status === 'BOND_STATUS_BONDED' ? 'å·²ç»‘å®š' : 'æœªç»‘å®š';
                const tokens = (parseInt(validator.tokens) / 1000000).toLocaleString();

                html += `
                    <div class="validator-item">
                        <h4>âš¡ ${validator.description.moniker}</h4>
                        <div class="validator-address">${validator.operator_address}</div>
                        <div><span class="validator-status ${status}">${statusText}</span></div>
                        <div class="validator-tokens">è´¨æŠ¼: ${tokens} stake</div>
                        <div>ä½£é‡‘ç‡: ${(parseFloat(validator.commission.commission_rates.rate) * 100).toFixed(2)}%</div>
                        <div>æ˜¯å¦ç›‘ç¦: ${validator.jailed ? 'æ˜¯' : 'å¦'}</div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // æ›´æ–°è´¦æˆ·é€‰æ‹©é€‰é¡¹
        function updateAccountSelects() {
            const selects = [
                'from-account', 
                'to-account', 
                'validator-account', 
                'delegate-account'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">é€‰æ‹©è´¦æˆ·</option>';
                    allWallets.forEach(wallet => {
                        select.innerHTML += `<option value="${wallet.name}">${wallet.name} (${wallet.address})</option>`;
                    });
                }
            });
        }

        // æ›´æ–°éªŒè¯è€…é€‰æ‹©é€‰é¡¹
        function updateValidatorOptions() {
            const select = document.getElementById('delegate-validator');
            if (select) {
                select.innerHTML = '<option value="">é€‰æ‹©éªŒè¯è€…</option>';
                allValidators.forEach(validator => {
                    select.innerHTML += `<option value="${validator.operator_address}">${validator.description.moniker}</option>`;
                });
            }
        }

        // æ›´æ–°éªŒè¯è€…è´¦æˆ·é€‰é¡¹
        function updateValidatorAccountOptions() {
            const selects = ['validator-account', 'delegate-account'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select && allWallets.length > 0) {
                    select.innerHTML = '<option value="">é€‰æ‹©è´¦æˆ·</option>';
                    allWallets.forEach(wallet => {
                        select.innerHTML += `<option value="${wallet.name}">${wallet.name}</option>`;
                    });
                }
            });
        }

        // å¤„ç†è¡¨å•å˜åŒ–
        document.getElementById('from-account').addEventListener('change', function() {
            const toSelect = document.getElementById('to-account');
            const fromValue = this.value;
            
            // è‡ªåŠ¨è®¾ç½®ç›®æ ‡è´¦æˆ·ä¸ºå¦ä¸€ä¸ªè´¦æˆ·
            if (allWallets.length >= 2) {
                const otherWallet = allWallets.find(w => w.name !== fromValue);
                if (otherWallet) {
                    toSelect.value = otherWallet.name;
                }
            }
        });
    </script>
</body>
</html>
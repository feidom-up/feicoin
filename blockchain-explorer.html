<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FeiCoin Âå∫ÂùóÈìæÊµèËßàÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 6px;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            min-height: calc(100vh - 150px);
        }
        
        .operations-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .logs-panel {
            position: sticky;
            top: 30px;
            height: fit-content;
            max-height: calc(100vh - 150px);
            overflow: hidden;
        }

        .section {
            margin-bottom: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }


        .transfer-form {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 12px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 12px;
        }
        
        .form-row .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            border: 2px solid #333;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .log-level-info { color: #00ff00; }
        .log-level-error { color: #ff0000; }
        .log-level-warning { color: #ffff00; }
        .log-level-transfer { color: #00bfff; }
        .log-level-success { color: #32cd32; }
        
        .transfer-separator {
            border: none;
            border-top: 2px solid #444;
            margin: 15px 0;
            background: linear-gradient(90deg, transparent 0%, #00bfff 20%, #00bfff 80%, transparent 100%);
            height: 2px;
            position: relative;
        }
        
        .transfer-separator::before {
            content: 'üí∏ ËΩ¨Ë¥¶ÊµÅÁ®ã üí∏';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e1e1e;
            color: #00bfff;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .transfer-end-separator {
            border: none;
            border-top: 2px solid #444;
            margin: 15px 0;
            background: linear-gradient(90deg, transparent 0%, #32cd32 20%, #32cd32 80%, transparent 100%);
            height: 2px;
            position: relative;
        }
        
        .transfer-end-separator::before {
            content: '‚úÖ ËΩ¨Ë¥¶ÂÆåÊàê ‚úÖ';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e1e1e;
            color: #32cd32;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .transfer-log {
            background: rgba(0, 191, 255, 0.1);
            border-left: 3px solid #00bfff;
            padding-left: 10px;
            margin: 2px 0;
        }
        
        .success-log {
            background: rgba(50, 205, 50, 0.15);
            border-left: 3px solid #32cd32;
            padding-left: 10px;
            margin: 2px 0;
        }

        .status {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .blockchain-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .info-card {
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 3px solid #4CAF50;
        }

        .info-card h4 {
            color: #666;
            font-size: 0.8em;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .info-card .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
        }

        /* Èí±ÂåÖÁÆ°ÁêÜÊ†∑Âºè */
        .wallet-management,
        .validator-management {
            margin-top: 20px;
        }
        
        .wallet-actions,
        .validator-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .wallet-form,
        .validator-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        
        .wallet-form h3,
        .validator-form h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }
        
        .wallet-form textarea,
        .validator-form textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
        }
        
        .wallet-list,
        .validator-list {
            margin-top: 20px;
        }
        
        .wallet-item,
        .validator-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .wallet-item h4,
        .validator-item h4 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .wallet-address,
        .validator-address {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
            background: #f5f5f5;
            padding: 5px 8px;
            border-radius: 4px;
            margin: 5px 0;
            word-break: break-all;
        }
        
        .wallet-balance {
            margin: 8px 0;
            padding: 8px 12px;
            background: #e8f5e8;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .validator-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .validator-status.bonded {
            background: #d4edda;
            color: #155724;
        }
        
        .validator-status.unbonded {
            background: #f8d7da;
            color: #721c24;
        }
        
        .validator-tokens {
            font-weight: bold;
            color: #2196F3;
        }
        
        .mnemonic-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        
        .mnemonic-warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            color: #721c24;
            font-weight: bold;
        }
        
        /* Èí±ÂåÖÁÆÄ‰ªãÊ®°ÂºèÊ†∑Âºè */
        .wallet-item-compact {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin: 6px;
            border-left: 3px solid #4CAF50;
            display: block;
            min-width: 180px;
            flex: 1;
        }
        
        .wallets-container-horizontal {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .wallet-compact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wallet-compact-info {
            flex: 1;
        }
        
        .wallet-compact-name {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 2px;
            font-size: 0.9em;
        }
        
        .wallet-compact-balance {
            font-size: 0.8em;
            color: #666;
            font-family: 'Courier New', monospace;
            margin-bottom: 4px;
        }
        
        .wallet-compact-actions {
            display: flex;
            gap: 4px;
            align-items: center;
            flex-shrink: 0;
        }
        
        .wallet-compact-actions-mini {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-top: 6px;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 0.75em;
            border-radius: 3px;
        }
        
        .btn-mini {
            padding: 3px 6px;
            font-size: 0.7em;
            border-radius: 3px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-mini:hover {
            transform: scale(1.05);
        }
        
        .wallet-details {
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            display: none;
        }
        
        .wallet-details.expanded {
            display: block;
        }
        
        .wallet-details .wallet-address {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #666;
            background: #fff;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            word-break: break-all;
            border: 1px solid #ddd;
        }
        
        .expand-btn {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            font-size: 0.85em;
            text-decoration: underline;
            padding: 2px 4px;
            white-space: nowrap;
        }
        
        .expand-btn:hover {
            color: #0056b3;
        }
        
        /* Â•ñÂä±ÁÆ°ÁêÜÊ†∑Âºè */
        .rewards-management {
            margin-top: 20px;
        }
        
        .rewards-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 15px 0;
            border-left: 4px solid #FF9800;
        }
        
        .rewards-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .rewards-header h3 {
            color: #FF9800;
            margin: 0;
            font-size: 1.1em;
        }
        
        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #fff3e0;
            border-radius: 6px;
            margin: 8px 0;
            border: 1px solid #ffcc02;
        }
        
        .reward-info {
            flex: 1;
        }
        
        .reward-amount {
            font-weight: bold;
            color: #FF9800;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }
        
        .reward-validator {
            font-size: 0.9em;
            color: #666;
            margin-top: 4px;
        }
        
        .reward-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-reward {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-reward:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }
        
        .btn-reward:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .total-rewards {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #4CAF50;
            text-align: center;
            margin: 10px 0;
        }
        
        .total-rewards .amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #4CAF50;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .wallet-actions,
            .validator-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ FeiCoin Âå∫ÂùóÈìæÊµèËßàÂô®</h1>
            <p>ÁúüÂÆûÂå∫ÂùóÈìæÊµèËßàÂô® - ËøûÊé• FeiCoin ÁΩëÁªúÔºåÊâßË°åÁúüÂÆûËΩ¨Ë¥¶‰∫§Êòì</p>
        </div>

        <div class="main-content">
            <!-- Â∑¶‰æßÔºöÊìç‰ΩúÈù¢Êùø -->
            <div class="operations-panel">
                <!-- Âå∫ÂùóÈìæÁä∂ÊÄÅ -->
                <div class="section">
                    <h2>‚õìÔ∏è Âå∫ÂùóÈìæÁä∂ÊÄÅ</h2>
                    <div class="blockchain-info">
                        <div class="info-card">
                            <h4>ÂΩìÂâçÈ´òÂ∫¶</h4>
                            <div class="value" id="block-height">-</div>
                        </div>
                        <div class="info-card">
                            <h4>È™åËØÅËÄÖÊï∞Èáè</h4>
                            <div class="value" id="validator-count">-</div>
                        </div>
                        <div class="info-card">
                            <h4>ÁΩëÁªúID</h4>
                            <div class="value" id="chain-id">-</div>
                        </div>
                        <div class="info-card">
                            <h4>ÊúÄÊñ∞Âå∫ÂùóÊó∂Èó¥</h4>
                            <div class="value" id="block-time" style="font-size: 1em;">-</div>
                        </div>
                    </div>
                </div>

                <!-- ËΩ¨Ë¥¶‰∏éÈí±ÂåÖÁÆ°ÁêÜËûçÂêà -->
                <div class="section">
                    <h2>üí∏ ËΩ¨Ë¥¶ & Èí±ÂåÖÁÆ°ÁêÜ</h2>
                    
                    <!-- Èí±ÂåÖ‰ΩôÈ¢ùÊòæÁ§∫ -->
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h3 style="font-size: 1.1em; margin: 0; color: #333;">üí∞ Ë¥¶Êà∑‰ΩôÈ¢ù</h3>
                            <div>
                                <button class="btn-mini" onclick="refreshWalletList()">üîÑ</button>
                                <button class="btn-mini" onclick="showCreateWallet()">+</button>
                                <button class="btn-mini" onclick="showImportWallet()">üì•</button>
                            </div>
                        </div>
                        <div class="wallets-container-horizontal" id="wallets-container">
                            Âä†ËΩΩ‰∏≠...
                        </div>
                    </div>
                    
                    <!-- ËΩ¨Ë¥¶Ë°®Âçï -->
                    <div class="transfer-form">
                        <div class="form-row">
                            <div class="form-group" style="flex: 1; margin-right: 10px;">
                                <label for="from-account">‰ªéË¥¶Êà∑:</label>
                                <select id="from-account">
                                    <option value="alice">Alice (feic1kpyhmumrt5g0veex9lhpzh3m99rptmmuz7cq8u)</option>
                                    <option value="bob">Bob (feic1kfde52eamxnnwkn2yjv9uj5xuf0amxuh70tnpw)</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="to-account">Âà∞Ë¥¶Êà∑:</label>
                                <select id="to-account">
                                    <option value="bob">Bob (feic1kfde52eamxnnwkn2yjv9uj5xuf0amxuh70tnpw)</option>
                                    <option value="alice">Alice (feic1kpyhmumrt5g0veex9lhpzh3m99rptmmuz7cq8u)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2; margin-right: 10px;">
                                <label for="amount">ËΩ¨Ë¥¶ÈáëÈ¢ù:</label>
                                <input type="number" id="amount" placeholder="ËæìÂÖ•ËΩ¨Ë¥¶ÈáëÈ¢ù" min="1">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="denom">‰ª£Â∏ÅÁ±ªÂûã:</label>
                                <select id="denom">
                                    <option value="token">token</option>
                                    <option value="stake">stake</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="sendTransfer()" id="transfer-btn">üí≥ ÂèëËµ∑ËΩ¨Ë¥¶</button>
                    </div>
                    <div id="transfer-status"></div>
                    
                    <!-- Èí±ÂåÖÂàõÂª∫/ÂØºÂÖ•Ë°®Âçï -->
                    <div id="create-wallet-form" class="wallet-form" style="display: none;">
                        <h3>ÂàõÂª∫Êñ∞Èí±ÂåÖ</h3>
                        <div class="form-group">
                            <label for="new-wallet-name">Èí±ÂåÖÂêçÁß∞:</label>
                            <input type="text" id="new-wallet-name" placeholder="ËæìÂÖ•Èí±ÂåÖÂêçÁß∞">
                        </div>
                        <button class="btn" onclick="createWallet()">üîë ÂàõÂª∫Èí±ÂåÖ</button>
                        <button class="btn" onclick="hideWalletForms()">‚ùå ÂèñÊ∂à</button>
                    </div>
                    
                    <div id="import-wallet-form" class="wallet-form" style="display: none;">
                        <h3>ÂØºÂÖ•Èí±ÂåÖ</h3>
                        <div class="form-group">
                            <label for="import-wallet-name">Èí±ÂåÖÂêçÁß∞:</label>
                            <input type="text" id="import-wallet-name" placeholder="ËæìÂÖ•Èí±ÂåÖÂêçÁß∞">
                        </div>
                        <div class="form-group">
                            <label for="wallet-mnemonic">Âä©ËÆ∞ËØç:</label>
                            <textarea id="wallet-mnemonic" placeholder="ËæìÂÖ•12Êàñ24‰∏™Âä©ËÆ∞ËØçÔºåÁî®Á©∫Ê†ºÂàÜÈöî" rows="3"></textarea>
                        </div>
                        <button class="btn" onclick="importWallet()">üì• ÂØºÂÖ•Èí±ÂåÖ</button>
                        <button class="btn" onclick="hideWalletForms()">‚ùå ÂèñÊ∂à</button>
                    </div>
                </div>


                <!-- È™åËØÅËÄÖÁÆ°ÁêÜ -->
                <div class="section">
                    <h2>‚ö° È™åËØÅËÄÖÁÆ°ÁêÜ</h2>
                    <div class="validator-management">
                        <div class="validator-actions">
                            <button class="btn" onclick="refreshValidatorList()">üîÑ Âà∑Êñ∞È™åËØÅËÄÖ</button>
                            <button class="btn" onclick="showCreateValidator()">‚ûï ÂàõÂª∫È™åËØÅËÄÖ</button>
                            <button class="btn" onclick="showDelegateForm()">ü§ù ÂßîÊâòË¥®Êäº</button>
                        </div>
                        
                        <!-- ÂàõÂª∫È™åËØÅËÄÖË°®Âçï -->
                        <div id="create-validator-form" class="validator-form" style="display: none;">
                            <h3>ÂàõÂª∫È™åËØÅËÄÖ</h3>
                            <div class="form-group">
                                <label for="validator-account">Ë¥¶Êà∑:</label>
                                <select id="validator-account">
                                    <option value="">ÈÄâÊã©Ë¥¶Êà∑</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="validator-amount">Ë¥®ÊäºÈáëÈ¢ù:</label>
                                <input type="number" id="validator-amount" placeholder="Ë¥®ÊäºÈáëÈ¢ù" min="1000000">
                            </div>
                            <div class="form-group">
                                <label for="validator-moniker">È™åËØÅËÄÖÂêçÁß∞:</label>
                                <input type="text" id="validator-moniker" placeholder="È™åËØÅËÄÖÊòæÁ§∫ÂêçÁß∞">
                            </div>
                            <div class="form-group">
                                <label for="validator-commission">‰Ω£ÈáëÁéá (%):</label>
                                <input type="number" id="validator-commission" placeholder="10" min="0" max="100" step="0.01">
                            </div>
                            <button class="btn" onclick="createValidator()">‚ö° ÂàõÂª∫È™åËØÅËÄÖ</button>
                            <button class="btn" onclick="hideValidatorForms()">‚ùå ÂèñÊ∂à</button>
                        </div>
                        
                        <!-- ÂßîÊâòË°®Âçï -->
                        <div id="delegate-form" class="validator-form" style="display: none;">
                            <h3>ÂßîÊâòË¥®Êäº</h3>
                            <div class="form-group">
                                <label for="delegate-account">Ë¥¶Êà∑:</label>
                                <select id="delegate-account">
                                    <option value="">ÈÄâÊã©Ë¥¶Êà∑</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="delegate-validator">È™åËØÅËÄÖ:</label>
                                <select id="delegate-validator">
                                    <option value="">ÈÄâÊã©È™åËØÅËÄÖ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="delegate-amount">ÂßîÊâòÈáëÈ¢ù:</label>
                                <input type="number" id="delegate-amount" placeholder="ÂßîÊâòÈáëÈ¢ù" min="1">
                            </div>
                            <button class="btn" onclick="delegateStake()">ü§ù ÂßîÊâòË¥®Êäº</button>
                            <button class="btn" onclick="hideValidatorForms()">‚ùå ÂèñÊ∂à</button>
                        </div>
                        
                        <!-- È™åËØÅËÄÖÂàóË°® -->
                        <div class="validator-list" id="validator-list">
                            <h3>È™åËØÅËÄÖÂàóË°®</h3>
                            <div id="validators-container">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                        
                        <!-- Â•ñÂä±ÁÆ°ÁêÜ -->
                        <div class="rewards-management">
                            <div class="rewards-container">
                                <div class="rewards-header">
                                    <h3>üèÜ Â•ñÂä±ÁÆ°ÁêÜ</h3>
                                    <button class="btn-mini" onclick="refreshRewards()" title="Âà∑Êñ∞Â•ñÂä±">üîÑ</button>
                                </div>
                                
                                <!-- ÊÄªÂ•ñÂä±ÁªüËÆ° -->
                                <div class="total-rewards" id="total-rewards">
                                    <div>ÊÄªËÆ°Êú™ÊèêÂèñÂ•ñÂä±</div>
                                    <div class="amount" id="total-reward-amount">Âä†ËΩΩ‰∏≠...</div>
                                </div>
                                
                                <!-- Â•ñÂä±ËØ¶ÊÉÖÂàóË°® -->
                                <div id="rewards-list">
                                    Âä†ËΩΩ‰∏≠...
                                </div>
                                
                                <!-- ÊâπÈáèÊìç‰Ωú -->
                                <div style="text-align: center; margin-top: 15px;">
                                    <button class="btn-reward" onclick="withdrawAllRewards()" id="withdraw-all-btn">
                                        üí∞ ÊèêÂèñÊâÄÊúâÂ•ñÂä±
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥‰æßÔºöÊó•ÂøóÈù¢Êùø -->
            <div class="logs-panel">
                <div class="section">
                    <h2>üìã Âå∫ÂùóÈìæÊâßË°åÊó•Âøó</h2>
                    <div style="margin-bottom: 15px;">
                        <button class="btn" onclick="clearLogs()">üóëÔ∏è Ê∏ÖÈô§Êó•Âøó</button>
                        <button class="btn" onclick="toggleAutoRefresh()">
                            <span id="auto-refresh-text">‚è∏Ô∏è ÂÅúÊ≠¢Ëá™Âä®Âà∑Êñ∞</span>
                        </button>
                    </div>
                    <div class="logs" id="blockchain-logs">
                        <div class="log-entry">
                            <span class="log-timestamp">[Á≥ªÁªüÂêØÂä®]</span>
                            <span class="log-level-info">[INFO]</span> üéØ Âå∫ÂùóÈìæÊµèËßàÂô®Â∑≤Âä†ËΩΩÔºåÁ≠âÂæÖËøûÊé•Âå∫ÂùóÈìæÁΩëÁªú...
                        </div>
                        <div class="log-entry" style="color: #666; font-style: italic;">
                            <span class="log-timestamp">[‰ΩøÁî®ÊèêÁ§∫]</span>
                            üí° ËΩ¨Ë¥¶Êó•ÂøóÂ∞Ü‰ª•ËìùËâ≤È´ò‰∫ÆÊòæÁ§∫ÔºåÊàêÂäüÊìç‰Ωú‰ª•ÁªøËâ≤ÊòæÁ§∫
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ë¥¶Êà∑Âú∞ÂùÄÊò†Â∞Ñ (Âä®ÊÄÅÊõ¥Êñ∞)
        let accounts = {
            alice: 'feic1kpyhmumrt5g0veex9lhpzh3m99rptmmuz7cq8u',
            bob: 'feic1kfde52eamxnnwkn2yjv9uj5xuf0amxuh70tnpw'
        };
        
        let allWallets = [];
        let allValidators = [];

        // Ëé∑ÂèñË¥¶Êà∑Âú∞ÂùÄÁöÑÈÄöÁî®ÂáΩÊï∞
        function getAccountAddress(accountName) {
            // È¶ñÂÖàÊ£ÄÊü•ÈùôÊÄÅÊò†Â∞Ñ
            if (accounts[accountName]) {
                return accounts[accountName];
            }
            
            // ÁÑ∂ÂêéÊ£ÄÊü•Âä®ÊÄÅÈí±ÂåÖÂàóË°®
            const wallet = allWallets.find(w => w.name === accountName);
            if (wallet) {
                return wallet.address;
            }
            
            // Â¶ÇÊûúÂ∑≤ÁªèÊòØÂú∞ÂùÄÊ†ºÂºèÔºåÁõ¥Êé•ËøîÂõû
            if (accountName && accountName.startsWith('feic1')) {
                return accountName;
            }
            
            console.error(`Êó†Ê≥ïÊâæÂà∞Ë¥¶Êà∑ ${accountName} ÁöÑÂú∞ÂùÄ`);
            return null;
        }

        let autoRefreshInterval;
        let isAutoRefreshing = true;

        // Ê∑ªÂä†Êó•ÂøóÂáΩÊï∞
        function addLog(level, message) {
            const logs = document.getElementById('blockchain-logs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span> ${message}
            `;
            logs.insertBefore(logEntry, logs.firstChild);
            
            // ‰øùÊåÅÊúÄÊñ∞ÁöÑ100Êù°Êó•Âøó
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        // Ê∑ªÂä†ËΩ¨Ë¥¶‰∏ìÁî®Êó•ÂøóÂáΩÊï∞
        function addTransferLog(level, message) {
            const logs = document.getElementById('blockchain-logs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry transfer-log`;
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span> ${message}
            `;
            logs.insertBefore(logEntry, logs.firstChild);
            
            // ‰øùÊåÅÊúÄÊñ∞ÁöÑ100Êù°Êó•Âøó
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        // Ê∑ªÂä†ÊàêÂäüÊó•ÂøóÂáΩÊï∞
        function addSuccessLog(message) {
            const logs = document.getElementById('blockchain-logs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry success-log`;
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-success">[SUCCESS]</span> ${message}
            `;
            logs.insertBefore(logEntry, logs.firstChild);
            
            // ‰øùÊåÅÊúÄÊñ∞ÁöÑ100Êù°Êó•Âøó
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        // Ê∑ªÂä†ÂàÜÂâ≤Á∫ø
        function addTransferSeparator() {
            const logs = document.getElementById('blockchain-logs');
            const separator = document.createElement('div');
            separator.className = 'transfer-separator';
            logs.insertBefore(separator, logs.firstChild);
        }

        // Ê∑ªÂä†ËΩ¨Ë¥¶ÁªìÊùüÂàÜÂâ≤Á∫ø
        function addTransferEndSeparator() {
            const logs = document.getElementById('blockchain-logs');
            const separator = document.createElement('div');
            separator.className = 'transfer-end-separator';
            logs.insertBefore(separator, logs.firstChild);
        }

        // ÊòæÁ§∫Áä∂ÊÄÅ‰ø°ÊÅØ
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('transfer-status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 5000);
            }
        }

        // Ëé∑Âèñ‰ΩôÈ¢ù - ÊîØÊåÅË¥¶Êà∑ÂêçÂíåÂú∞ÂùÄ
        async function getBalance(account) {
            try {
                // Â¶ÇÊûúÊòØÂú∞ÂùÄÁõ¥Êé•‰ΩøÁî®ÔºåÂ¶ÇÊûúÊòØË¥¶Êà∑ÂêçÂàô‰ªéaccountsÊü•Êâæ
                let address = account;
                if (accounts[account]) {
                    address = accounts[account];
                } else if (!account.startsWith('feic1')) {
                    // Â¶ÇÊûú‰∏çÊòØÂú∞ÂùÄ‰πü‰∏çÂú®accounts‰∏≠ÔºåÂ∞ùËØï‰ªéallWalletsÊü•Êâæ
                    const wallet = allWallets.find(w => w.name === account);
                    if (wallet) {
                        address = wallet.address;
                    }
                }
                
                const response = await fetch(`http://localhost:1317/cosmos/bank/v1beta1/balances/${address}`);
                const data = await response.json();
                return data.balances;
            } catch (error) {
                addLog('error', `Ëé∑Âèñ${account}‰ΩôÈ¢ùÂ§±Ë¥•: ${error.message}`);
                return [];
            }
        }

        // Âà∑Êñ∞‰ΩôÈ¢ùÊòæÁ§∫ - Áé∞Âú®Êõ¥Êñ∞Èí±ÂåÖÂàóË°®‰∏≠ÁöÑ‰ΩôÈ¢ù
        async function refreshBalances() {
            addLog('info', 'Ê≠£Âú®Âà∑Êñ∞Ë¥¶Êà∑‰ΩôÈ¢ù...');
            
            // Â¶ÇÊûúÈí±ÂåÖÂàóË°®Â∑≤Âä†ËΩΩÔºåÂàôÂà∑Êñ∞Èí±ÂåÖ‰ΩôÈ¢ùÊòæÁ§∫
            if (allWallets.length > 0) {
                for (const wallet of allWallets) {
                    try {
                        const balance = await getBalance(wallet.address);
                        const balanceElement = document.getElementById(`balance-${wallet.name}`);
                        if (balanceElement && balance.length > 0) {
                            const balanceHtml = balance.map(b => 
                                `${parseInt(b.amount).toLocaleString()} ${b.denom}`
                            ).join('<br>');
                            balanceElement.innerHTML = balanceHtml;
                        } else if (balanceElement) {
                            balanceElement.innerHTML = '0';
                        }
                    } catch (error) {
                        console.error(`Âà∑Êñ∞${wallet.name}‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
                    }
                }
            }
            
            addLog('info', 'Èí±ÂåÖ‰ΩôÈ¢ùÂ∑≤Êõ¥Êñ∞');
        }

        // Ëé∑ÂèñÂå∫ÂùóÈìæÁä∂ÊÄÅ
        async function getBlockchainStatus() {
            try {
                // Ëé∑ÂèñÊúÄÊñ∞Âå∫Âùó‰ø°ÊÅØ
                const blockResponse = await fetch('http://localhost:1317/cosmos/base/tendermint/v1beta1/blocks/latest');
                const blockData = await blockResponse.json();
                
                // Ëé∑ÂèñËäÇÁÇπ‰ø°ÊÅØ
                const nodeResponse = await fetch('http://localhost:1317/cosmos/base/tendermint/v1beta1/node_info');
                const nodeData = await nodeResponse.json();
                
                // Ëé∑ÂèñÈ™åËØÅËÄÖ‰ø°ÊÅØ
                const validatorResponse = await fetch('http://localhost:1317/cosmos/staking/v1beta1/validators');
                const validatorData = await validatorResponse.json();
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                document.getElementById('block-height').textContent = blockData.block.header.height;
                document.getElementById('validator-count').textContent = validatorData.validators.length;
                document.getElementById('chain-id').textContent = nodeData.default_node_info.network;
                document.getElementById('block-time').textContent = new Date(blockData.block.header.time).toLocaleTimeString();
                
                addLog('info', `Âå∫Âùó #${blockData.block.header.height} Â∑≤Á°ÆËÆ§ÔºåÂåÖÂê´ ${blockData.block.data.txs ? blockData.block.data.txs.length : 0} Á¨î‰∫§Êòì`);
            } catch (error) {
                addLog('error', `Ëé∑ÂèñÂå∫ÂùóÈìæÁä∂ÊÄÅÂ§±Ë¥•: ${error.message}`);
            }
        }

        // ÁúüÂÆûËΩ¨Ë¥¶ÂäüËÉΩ - ‰ΩøÁî® CLI ÂëΩ‰ª§ÊâßË°åÂÆûÈôÖËΩ¨Ë¥¶
        async function sendTransfer() {
            const fromAccount = document.getElementById('from-account').value;
            const toAccount = document.getElementById('to-account').value;
            const amount = document.getElementById('amount').value;
            const denom = document.getElementById('denom').value;

            if (!amount || amount <= 0) {
                showStatus('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑËΩ¨Ë¥¶ÈáëÈ¢ù', 'error');
                return;
            }

            if (fromAccount === toAccount) {
                showStatus('‰∏çËÉΩÂêëËá™Â∑±ËΩ¨Ë¥¶', 'error');
                return;
            }

            // È™åËØÅË¥¶Êà∑Âú∞ÂùÄ
            const fromAddress = getAccountAddress(fromAccount);
            const toAddress = getAccountAddress(toAccount);
            
            if (!fromAddress) {
                showStatus(`Êó†Ê≥ïÊâæÂà∞ÂèëÈÄÅË¥¶Êà∑ ${fromAccount} ÁöÑÂú∞ÂùÄ`, 'error');
                return;
            }
            
            if (!toAddress) {
                showStatus(`Êó†Ê≥ïÊâæÂà∞Êé•Êî∂Ë¥¶Êà∑ ${toAccount} ÁöÑÂú∞ÂùÄ`, 'error');
                return;
            }

            // Á¶ÅÁî®ÊåâÈíÆ
            document.getElementById('transfer-btn').disabled = true;
            showStatus(`Ê≠£Âú®Â§ÑÁêÜ‰ªé ${fromAccount} Âà∞ ${toAccount} ÁöÑ ${amount} ${denom} ËΩ¨Ë¥¶...`, 'loading');
            
            // Ê∑ªÂä†ËΩ¨Ë¥¶ÂºÄÂßãÂàÜÂâ≤Á∫ø
            addTransferSeparator();
            
            addTransferLog('transfer', `üöÄ ÁúüÂÆûËΩ¨Ë¥¶‰∫§ÊòìÂºÄÂßãÔºÅ`);
            addTransferLog('transfer', `üì§ ÂèëÈÄÅÊñπ: ${fromAccount.toUpperCase()} ‚Üí ${getAccountAddress(fromAccount)}`);
            addTransferLog('transfer', `üì• Êé•Êî∂Êñπ: ${toAccount.toUpperCase()} ‚Üí ${getAccountAddress(toAccount)}`);
            addTransferLog('transfer', `üí∞ ËΩ¨Ë¥¶ÈáëÈ¢ù: ${parseInt(amount).toLocaleString()} ${denom.toUpperCase()}`);
            
            try {
                addTransferLog('transfer', 'üîç Á¨¨1Ê≠•ÔºöÈ™åËØÅË¥¶Êà∑‰ΩôÈ¢ù...');
                
                // Ê£ÄÊü•ÂèëÈÄÅÊñπ‰ΩôÈ¢ù
                const senderBalance = await getBalance(fromAccount);
                const tokenBalance = senderBalance.find(b => b.denom === denom);
                
                if (!tokenBalance || parseInt(tokenBalance.amount) < parseInt(amount)) {
                    throw new Error(`‰ΩôÈ¢ù‰∏çË∂≥„ÄÇÈúÄË¶Å ${amount} ${denom}Ôºå‰ΩÜÂè™Êúâ ${tokenBalance ? tokenBalance.amount : 0} ${denom}`);
                }
                
                addTransferLog('transfer', '‚úÖ ‰ΩôÈ¢ùÈ™åËØÅÈÄöËøá - Ë¥¶Êà∑ËµÑÈáëÂÖÖË∂≥');
                addTransferLog('transfer', 'üîê Á¨¨2Ê≠•ÔºöÈÄöËøáËΩ¨Ë¥¶ÊúçÂä°Âô®ÊâßË°å‰∫§Êòì...');
                
                try {
                    const response = await fetch('http://localhost:3001/transfer', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            fromAccount: fromAccount,
                            toAccount: getAccountAddress(toAccount),
                            amount: amount,
                            denom: denom
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        addTransferLog('transfer', '‚úÖ ËΩ¨Ë¥¶ÂëΩ‰ª§ÊâßË°åÊàêÂäü');
                        addTransferLog('transfer', 'üì° Á¨¨3Ê≠•Ôºö‰∫§ÊòìÂ∑≤ÂπøÊí≠Âà∞Âå∫ÂùóÈìæÁΩëÁªú...');
                        
                        // ‰ªéËøîÂõûÁªìÊûú‰∏≠ÊèêÂèñ‰∫§ÊòìÂìàÂ∏å
                        const txHashMatch = result.output.match(/txhash: ([A-F0-9]+)/);
                        const txHash = txHashMatch ? txHashMatch[1] : null;
                        
                        if (txHash) {
                            addTransferLog('transfer', `üìã ‰∫§ÊòìÂìàÂ∏å: ${txHash}`);
                            addTransferLog('transfer', '‚õìÔ∏è Á¨¨4Ê≠•ÔºöÁ≠âÂæÖÂå∫ÂùóÈìæÁΩëÁªúÁ°ÆËÆ§‰∫§Êòì...');
                            addTransferLog('transfer', 'üîç ÂºÄÂßãÁõëÊéß‰∫§ÊòìÁä∂ÊÄÅ...');
                            
                            // ÁúüÊ≠£Á≠âÂæÖÂå∫ÂùóÁ°ÆËÆ§
                            let confirmed = false;
                            let attempts = 0;
                            const maxAttempts = 30; // ÊúÄÂ§öÁ≠âÂæÖ30Ê¨°ÔºåÊØèÊ¨°2Áßí
                            
                            while (!confirmed && attempts < maxAttempts) {
                                attempts++;
                                await new Promise(resolve => setTimeout(resolve, 2000));
                                
                                try {
                                    addTransferLog('transfer', `üîÑ Á¨¨${attempts}Ê¨°Êü•ËØ¢: Ê£ÄÊü•‰∫§ÊòìÊòØÂê¶Ë¢´ÊâìÂåÖÂà∞Âå∫Âùó‰∏≠...`);
                                    
                                    // Êü•ËØ¢‰∫§ÊòìÁä∂ÊÄÅ
                                    const txResponse = await fetch(`http://localhost:1317/cosmos/tx/v1beta1/txs/${txHash}`);
                                    
                                    if (txResponse.ok) {
                                        const txData = await txResponse.json();
                                        
                                        if (txData.tx_response) {
                                            const currentHeight = txData.tx_response.height;
                                            
                                            if (currentHeight === "0") {
                                                addTransferLog('transfer', `‚è≥ ‰∫§ÊòìËøòÂú®ÂÜÖÂ≠òÊ±†‰∏≠ÔºåÁ≠âÂæÖÈ™åËØÅËÄÖÊâìÂåÖ...`);
                                                
                                                // ÊòæÁ§∫Á≠âÂæÖËøõÂ∫¶
                                                const progress = Math.round((attempts / maxAttempts) * 100);
                                                addTransferLog('transfer', `üìä Á≠âÂæÖËøõÂ∫¶: ${progress}% (${attempts}/${maxAttempts})`);
                                            } else {
                                                confirmed = true;
                                                addTransferLog('transfer', `üéâ ‰∫§ÊòìÊàêÂäüÊâìÂåÖÔºÅÂå∫ÂùóÈ´òÂ∫¶: #${currentHeight}`);
                                                addTransferLog('transfer', `‚úÖ È™åËØÅËÄÖËäÇÁÇπÂ∑≤È™åËØÅÂπ∂Á°ÆËÆ§‰∫§Êòì`);
                                                addTransferLog('transfer', `üì¶ ‰∫§ÊòìÂ∑≤Ê∞∏‰πÖËÆ∞ÂΩïÂú®Âå∫ÂùóÈìæ‰∏ä`);
                                                addTransferLog('transfer', `‚õΩ Gas Ê∂àËÄó: ${txData.tx_response.gas_used}/${txData.tx_response.gas_wanted}`);
                                                
                                                // ÊòæÁ§∫ÊâãÁª≠Ë¥π‰ø°ÊÅØ
                                                if (txData.tx && txData.tx.auth_info && txData.tx.auth_info.fee) {
                                                    const fee = txData.tx.auth_info.fee;
                                                    if (fee.amount && fee.amount.length > 0) {
                                                        const feeAmount = fee.amount.map(f => `${f.amount} ${f.denom}`).join(', ');
                                                        addTransferLog('transfer', `üí≥ ÂÆûÈôÖÊâãÁª≠Ë¥π: ${feeAmount}`);
                                                    } else {
                                                        addTransferLog('transfer', `üí≥ ÂÆûÈôÖÊâãÁª≠Ë¥π: ÂÖçË¥π‰∫§Êòì (Gas Price = 0)`);
                                                    }
                                                } else {
                                                    addTransferLog('transfer', `üí≥ ÊâãÁª≠Ë¥π‰ø°ÊÅØ: Êú™ËÆæÁΩÆÊàñÂÖçË¥πÁΩëÁªú`);
                                                }
                                                
                                                addTransferLog('transfer', `üìÖ Âå∫ÂùóÁ°ÆËÆ§Êó∂Èó¥: ${new Date(txData.tx_response.timestamp).toLocaleString()}`);
                                                
                                                // ÊòæÁ§∫‰∫§ÊòìËØ¶ÊÉÖ
                                                if (txData.tx_response.events) {
                                                    const transferEvent = txData.tx_response.events.find(e => e.type === 'transfer');
                                                    if (transferEvent) {
                                                        const amountAttr = transferEvent.attributes.find(a => a.key === 'amount');
                                                        if (amountAttr) {
                                                            addTransferLog('transfer', `üí∞ Èìæ‰∏äÁ°ÆËÆ§ÈáëÈ¢ù: ${amountAttr.value}`);
                                                        }
                                                    }
                                                }
                                                break;
                                            }
                                        } else {
                                            addTransferLog('transfer', `‚ö†Ô∏è ‰∫§ÊòìÊï∞ÊçÆÊ†ºÂºèÂºÇÂ∏∏ÔºåÁªßÁª≠Á≠âÂæÖ...`);
                                        }
                                    } else {
                                        addTransferLog('transfer', `üîç ‰∫§ÊòìËøòÊú™Ë¢´ÁΩëÁªúÊé•Êî∂ÔºåÁªßÁª≠ÁõëÊéß...`);
                                    }
                                } catch (queryError) {
                                    addTransferLog('transfer', `‚ö†Ô∏è ÁΩëÁªúÊü•ËØ¢Â§±Ë¥•: ${queryError.message}`);
                                    addTransferLog('transfer', `üîÑ Â∞ÜÂú®2ÁßíÂêéÈáçËØï...`);
                                }
                            }
                            
                            if (!confirmed) {
                                addTransferLog('transfer', '‚è∞ Ë∂ÖÊó∂ÔºöÊú™ËÉΩÂú®È¢ÑÊúüÊó∂Èó¥ÂÜÖÁ°ÆËÆ§Ôºå‰ΩÜ‰∫§ÊòìÂèØËÉΩ‰ªçÂú®Â§ÑÁêÜ‰∏≠');
                            }
                        } else {
                            addTransferLog('transfer', '‚ö†Ô∏è Êú™ËÉΩËé∑Âèñ‰∫§ÊòìÂìàÂ∏åÔºå‰ΩøÁî®Â§áÁî®Á°ÆËÆ§ÊñπÂºè');
                            await new Promise(resolve => setTimeout(resolve, 5000));
                        }
                        
                        addTransferLog('transfer', 'üîç Á¨¨5Ê≠•ÔºöÈ™åËØÅ‰∫§ÊòìÁªìÊûú...');
                        
                        // Ê£ÄÊü•‰ΩôÈ¢ùÂèòÂåñ
                        const newSenderBalance = await getBalance(fromAccount);
                        const newReceiverBalance = await getBalance(toAccount);
                        
                        const newSenderTokenBalance = newSenderBalance.find(b => b.denom === denom);
                        const newReceiverTokenBalance = newReceiverBalance.find(b => b.denom === denom);
                        
                        // ÊØîËæÉ‰ΩôÈ¢ùÂèòÂåñ
                        const oldSenderAmount = parseInt(tokenBalance.amount);
                        const newSenderAmount = newSenderTokenBalance ? parseInt(newSenderTokenBalance.amount) : 0;
                        
                        if (newSenderAmount < oldSenderAmount) {
                            addSuccessLog('üéâ ËΩ¨Ë¥¶ÊàêÂäüÔºÅ‰∫§ÊòìÂ∑≤Âú®Âå∫ÂùóÈìæ‰∏äÁ°ÆËÆ§');
                            addSuccessLog(`üí∏ ${fromAccount.toUpperCase()} ‰ΩôÈ¢ùÂáèÂ∞ë ${oldSenderAmount - newSenderAmount} ${denom}`);
                            addSuccessLog(`üí∞ ${toAccount.toUpperCase()} ÂΩìÂâç‰ΩôÈ¢ù: ${newReceiverTokenBalance ? parseInt(newReceiverTokenBalance.amount).toLocaleString() : 0} ${denom}`);
                            addSuccessLog('üìä ÁúüÂÆûÂå∫ÂùóÈìæ‰∫§ÊòìÂÆåÊàê');
                            showStatus(`üéâ ËΩ¨Ë¥¶ÊàêÂäüÔºÅ‰ªé ${fromAccount} Âêë ${toAccount} ËΩ¨Ë¥¶ ${amount} ${denom}`, 'success');
                        } else {
                            addTransferLog('transfer', '‚ö†Ô∏è ‰ΩôÈ¢ùÊú™ÂèòÂåñÔºåÂèØËÉΩÈúÄË¶ÅÊõ¥Â§öÊó∂Èó¥Á°ÆËÆ§');
                            showStatus('ËΩ¨Ë¥¶Â∑≤Êèê‰∫§ÔºåËØ∑Á®çÂêéÊü•Áúã‰ΩôÈ¢ùÂèòÂåñ', 'success');
                        }
                        
                        // Ê∑ªÂä†ËΩ¨Ë¥¶ÁªìÊùüÂàÜÂâ≤Á∫ø
                        addTransferEndSeparator();
                        
                        // Âà∑Êñ∞‰ΩôÈ¢ùÊòæÁ§∫
                        refreshBalances();
                        
                    } else {
                        throw new Error(result.error || 'ËΩ¨Ë¥¶ÊúçÂä°Âô®ËøîÂõûÈîôËØØ');
                    }
                    
                } catch (transferError) {
                    addTransferLog('transfer', '‚ùå Ëá™Âä®ËΩ¨Ë¥¶Â§±Ë¥•ÔºåÂ∞ùËØïÊâãÂä®ÊñπÂºè...');
                    addTransferLog('transfer', `ÈîôËØØ‰ø°ÊÅØ: ${transferError.message}`);
                    
                    // Êèê‰æõÊâãÂä®ÂëΩ‰ª§‰Ωú‰∏∫Â§áÈÄâÊñπÊ°à
                    const toAddress = getAccountAddress(toAccount);
                    if (toAddress) {
                        const transferCommand = `/Users/ggbond/go/bin/feicoind tx bank send ${fromAccount} ${toAddress} ${amount}${denom} --from ${fromAccount} --keyring-backend test --chain-id feicoin --yes --node http://localhost:26657`;
                        addTransferLog('transfer', 'üìã ËØ∑Âú®ÁªàÁ´ØÊâãÂä®ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§:');
                        addTransferLog('transfer', `üîß ${transferCommand}`);
                    } else {
                        addTransferLog('transfer', '‚ùå Êó†Ê≥ïÁîüÊàêÊâãÂä®ÂëΩ‰ª§ÔºöÁõÆÊ†áË¥¶Êà∑Âú∞ÂùÄÊó†Êïà');
                    }
                    
                    // 10ÁßíÂêéÊ£ÄÊü•‰ΩôÈ¢ùÂèòÂåñ
                    setTimeout(async () => {
                        refreshBalances();
                        addTransferLog('transfer', 'üîÑ Â∑≤Âà∑Êñ∞‰ΩôÈ¢ùÔºåÂ¶ÇÊúâÂèòÂåñÂàôË°®Á§∫ËΩ¨Ë¥¶ÊàêÂäü');
                        addTransferEndSeparator();
                    }, 10000);
                    
                    showStatus('Ëá™Âä®ËΩ¨Ë¥¶Â§±Ë¥•ÔºåËØ∑Êü•ÁúãÊó•Âøó‰∏≠ÁöÑÊâãÂä®ÂëΩ‰ª§', 'error');
                }
                
            } catch (error) {
                addLog('error', `‚ùå ËΩ¨Ë¥¶Â§±Ë¥•: ${error.message}`);
                addTransferEndSeparator();
                showStatus('ËΩ¨Ë¥¶Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåË¥¶Êà∑Áä∂ÊÄÅ', 'error');
                // ÈáçÊñ∞ÂêØÁî®ÊåâÈíÆ
                document.getElementById('transfer-btn').disabled = false;
            }
        }

        // Ê∏ÖÈô§Êó•Âøó
        function clearLogs() {
            document.getElementById('blockchain-logs').innerHTML = '';
            addLog('info', 'Êó•ÂøóÂ∑≤Ê∏ÖÈô§');
        }

        // ÂàáÊç¢Ëá™Âä®Âà∑Êñ∞
        function toggleAutoRefresh() {
            const button = document.getElementById('auto-refresh-text');
            if (isAutoRefreshing) {
                clearInterval(autoRefreshInterval);
                isAutoRefreshing = false;
                button.textContent = '‚ñ∂Ô∏è ÂºÄÂßãËá™Âä®Âà∑Êñ∞';
                addLog('info', 'Ëá™Âä®Âà∑Êñ∞Â∑≤ÂÅúÊ≠¢');
            } else {
                startAutoRefresh();
                isAutoRefreshing = true;
                button.textContent = '‚è∏Ô∏è ÂÅúÊ≠¢Ëá™Âä®Âà∑Êñ∞';
                addLog('info', 'Ëá™Âä®Âà∑Êñ∞Â∑≤ÂêØÂä®');
            }
        }

        // ÂêØÂä®Ëá™Âä®Âà∑Êñ∞
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                refreshBalances();
                getBlockchainStatus();
            }, 5000); // ÊØè5ÁßíÂà∑Êñ∞‰∏ÄÊ¨°Ôºå‰∏é‰∫ã‰ª∂ÁõëÊéßÂêåÊ≠•
        }

        // ÁúüÂÆûÂå∫ÂùóÈìæ‰∫ã‰ª∂ÁõëÊéß
        let lastBlockHeight = 0;
        function monitorBlockchainEvents() {
            setInterval(async () => {
                try {
                    // Ëé∑ÂèñÊúÄÊñ∞Âå∫Âùó‰ø°ÊÅØ
                    const response = await fetch('http://localhost:1317/cosmos/base/tendermint/v1beta1/blocks/latest');
                    const data = await response.json();
                    const currentHeight = parseInt(data.block.header.height);
                    
                    // Ê£ÄÊµãÊñ∞Âå∫Âùó
                    if (lastBlockHeight > 0 && currentHeight > lastBlockHeight) {
                        const newBlocks = currentHeight - lastBlockHeight;
                        if (newBlocks === 1) {
                            addLog('info', `‚õìÔ∏è Êñ∞Âå∫Âùó #${currentHeight} Â∑≤ÁîüÊàê`);
                        } else {
                            addLog('info', `‚õìÔ∏è Ê£ÄÊµãÂà∞ ${newBlocks} ‰∏™Êñ∞Âå∫ÂùóÔºåÂΩìÂâçÈ´òÂ∫¶: ${currentHeight}`);
                        }
                        
                        // Ê£ÄÊü•Âå∫Âùó‰∏≠ÊòØÂê¶Êúâ‰∫§Êòì
                        const txCount = data.block.data.txs ? data.block.data.txs.length : 0;
                        if (txCount > 0) {
                            addLog('info', `üì¶ Âå∫Âùó #${currentHeight} ÂåÖÂê´ ${txCount} Á¨î‰∫§Êòì`);
                        }
                        
                        // ÂêåÊó∂Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫ÁöÑÂå∫ÂùóÈ´òÂ∫¶
                        document.getElementById('block-height').textContent = currentHeight;
                    }
                    
                    lastBlockHeight = currentHeight;
                } catch (error) {
                    // ÈùôÈªòÂ§ÑÁêÜÈîôËØØÔºåÈÅøÂÖçÊó•ÂøóÂô™Èü≥
                }
            }, 5000); // ÊØè5ÁßíÊ£ÄÊü•‰∏ÄÊ¨°Êñ∞Âå∫Âùó
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', async () => {
            addLog('info', 'üöÄ FeiCoin Âå∫ÂùóÈìæÊµèËßàÂô®Â∑≤ÂêØÂä®');
            addLog('info', 'üîó Ê≠£Âú®ËøûÊé•Âà∞Êú¨Âú∞ËäÇÁÇπ...');
            
            try {
                await getBlockchainStatus();
                addLog('info', '‚úÖ ÊàêÂäüËøûÊé•Âà∞Âå∫ÂùóÈìæÁΩëÁªú');
                
                // ÂàùÂßãÂåñÈí±ÂåÖÂíåÈ™åËØÅËÄÖÂàóË°®
                await refreshWalletList();
                await refreshValidatorList();
                
                // ÂàùÂßãÂåñÂ•ñÂä±ÁÆ°ÁêÜ
                await refreshRewards();
                
                // ÂêØÂä®Ëá™Âä®Âà∑Êñ∞
                startAutoRefresh();
                
                // ÂêØÂä®ÁúüÂÆûÂå∫ÂùóÈìæ‰∫ã‰ª∂ÁõëÊéß
                monitorBlockchainEvents();
                
            } catch (error) {
                addLog('error', `‚ùå ËøûÊé•Â§±Ë¥•: ${error.message}`);
                addLog('warning', 'ËØ∑Á°Æ‰øùÂå∫ÂùóÈìæËäÇÁÇπÊ≠£Âú®ËøêË°å (ignite chain serve)');
            }
        });

        // ===========================================
        // Èí±ÂåÖÁÆ°ÁêÜÂäüËÉΩ
        // ===========================================

        // ÊòæÁ§∫ÂàõÂª∫Èí±ÂåÖË°®Âçï
        function showCreateWallet() {
            hideWalletForms();
            document.getElementById('create-wallet-form').style.display = 'block';
        }

        // ÊòæÁ§∫ÂØºÂÖ•Èí±ÂåÖË°®Âçï
        function showImportWallet() {
            hideWalletForms();
            document.getElementById('import-wallet-form').style.display = 'block';
        }

        // ÈöêËóèÊâÄÊúâÈí±ÂåÖË°®Âçï
        function hideWalletForms() {
            document.getElementById('create-wallet-form').style.display = 'none';
            document.getElementById('import-wallet-form').style.display = 'none';
        }

        // ÂàõÂª∫Êñ∞Èí±ÂåÖ
        async function createWallet() {
            const name = document.getElementById('new-wallet-name').value.trim();
            if (!name) {
                showStatus('ËØ∑ËæìÂÖ•Èí±ÂåÖÂêçÁß∞', 'error');
                return;
            }

            try {
                addLog('info', `üîë Ê≠£Âú®ÂàõÂª∫Èí±ÂåÖ: ${name}`);
                const response = await fetch('http://localhost:3001/wallet/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ Èí±ÂåÖ "${name}" ÂàõÂª∫ÊàêÂäü!`);
                    
                    // ÊòæÁ§∫Âä©ËÆ∞ËØç
                    if (result.output && result.output.mnemonic) {
                        const mnemonicDiv = document.createElement('div');
                        mnemonicDiv.className = 'mnemonic-display';
                        mnemonicDiv.innerHTML = `
                            <div class="mnemonic-warning">‚ö†Ô∏è ËØ∑ÂÆâÂÖ®‰øùÂ≠ò‰ª•‰∏ãÂä©ËÆ∞ËØçÔºåËøôÊòØÊÅ¢Â§çÈí±ÂåÖÁöÑÂîØ‰∏ÄÊñπÂºèÔºÅ</div>
                            <strong>Âä©ËÆ∞ËØç:</strong><br>${result.output.mnemonic}
                        `;
                        document.getElementById('create-wallet-form').appendChild(mnemonicDiv);
                    }
                    
                    document.getElementById('new-wallet-name').value = '';
                    setTimeout(() => {
                        hideWalletForms();
                        refreshWalletList();
                    }, 5000);
                } else {
                    addLog('error', `‚ùå ÂàõÂª∫Èí±ÂåÖÂ§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÂàõÂª∫Èí±ÂåÖÂ§±Ë¥•: ${error.message}`);
            }
        }

        // ÂØºÂÖ•Èí±ÂåÖ
        async function importWallet() {
            const name = document.getElementById('import-wallet-name').value.trim();
            const mnemonic = document.getElementById('wallet-mnemonic').value.trim();
            
            if (!name || !mnemonic) {
                showStatus('ËØ∑ËæìÂÖ•Èí±ÂåÖÂêçÁß∞ÂíåÂä©ËÆ∞ËØç', 'error');
                return;
            }

            try {
                addLog('info', `üì• Ê≠£Âú®ÂØºÂÖ•Èí±ÂåÖ: ${name}`);
                const response = await fetch('http://localhost:3001/wallet/import', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, mnemonic: mnemonic })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ Èí±ÂåÖ "${name}" ÂØºÂÖ•ÊàêÂäü!`);
                    document.getElementById('import-wallet-name').value = '';
                    document.getElementById('wallet-mnemonic').value = '';
                    hideWalletForms();
                    refreshWalletList();
                } else {
                    addLog('error', `‚ùå ÂØºÂÖ•Èí±ÂåÖÂ§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÂØºÂÖ•Èí±ÂåÖÂ§±Ë¥•: ${error.message}`);
            }
        }

        // Âà∑Êñ∞Èí±ÂåÖÂàóË°®
        async function refreshWalletList() {
            try {
                addLog('info', 'üîÑ Âà∑Êñ∞Èí±ÂåÖÂàóË°®...');
                const response = await fetch('http://localhost:3001/wallets/list');
                const result = await response.json();
                
                if (result.success) {
                    allWallets = result.output;
                    displayWallets();
                    updateAccountSelects();
                    addLog('info', `üìã Ëé∑ÂèñÂà∞ ${allWallets.length} ‰∏™Èí±ÂåÖ`);
                } else {
                    addLog('error', `‚ùå Ëé∑ÂèñÈí±ÂåÖÂàóË°®Â§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Ëé∑ÂèñÈí±ÂåÖÂàóË°®Â§±Ë¥•: ${error.message}`);
            }
        }

        // ÊòæÁ§∫Èí±ÂåÖÂàóË°®ÔºàÊ®™ÂêëÁ¥ßÂáëÊ®°ÂºèÔºâ
        async function displayWallets() {
            const container = document.getElementById('wallets-container');
            
            if (allWallets.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ÊöÇÊó†Èí±ÂåÖÔºåËØ∑ÂàõÂª∫ÊàñÂØºÂÖ•Èí±ÂåÖ</div>';
                return;
            }

            // ÂÖàÊòæÁ§∫Èí±ÂåÖÁÆÄ‰ªã‰ø°ÊÅØÔºåÁÑ∂ÂêéÂºÇÊ≠•Âä†ËΩΩ‰ΩôÈ¢ù
            let html = '';
            for (const wallet of allWallets) {
                html += `
                    <div class="wallet-item-compact" id="wallet-${wallet.name}">
                        <div class="wallet-compact-name">üîë ${wallet.name}</div>
                        <div class="wallet-compact-balance" id="balance-${wallet.name}">Âä†ËΩΩ‰∏≠...</div>
                        <div class="wallet-compact-actions-mini">
                            <button class="btn-mini" onclick="sendTokensToWallet('${wallet.address}')" title="ÂèëÈÄÅ1000 token">üí∞</button>
                            <button class="btn-mini" onclick="sendStakeToWallet('${wallet.address}')" title="ÂèëÈÄÅ1000 stake">ü•©</button>
                            <button class="btn-mini" onclick="toggleWalletDetails('${wallet.name}')" title="Êü•ÁúãËØ¶ÊÉÖ">üëÅÔ∏è</button>
                        </div>
                        <div class="wallet-details" id="details-${wallet.name}">
                            <div><strong>ÂÆåÊï¥Âú∞ÂùÄ:</strong></div>
                            <div class="wallet-address">${wallet.address}</div>
                            <div style="margin-top: 8px; text-align: center;">
                                <button class="btn btn-small" onclick="sendTokensToWallet('${wallet.address}')">üí∞ ÂèëÈÄÅ‰ª£Â∏Å</button>
                            </div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
            
            // ÂºÇÊ≠•Âä†ËΩΩÊØè‰∏™Èí±ÂåÖÁöÑ‰ΩôÈ¢ù
            for (const wallet of allWallets) {
                try {
                    const balance = await getBalance(wallet.address);
                    const balanceElement = document.getElementById(`balance-${wallet.name}`);
                    if (balanceElement && balance.length > 0) {
                        const balanceHtml = balance.map(b => 
                            `${parseInt(b.amount).toLocaleString()} ${b.denom}`
                        ).join('<br>');
                        balanceElement.innerHTML = balanceHtml;
                    } else if (balanceElement) {
                        balanceElement.innerHTML = '0';
                    }
                } catch (error) {
                    console.error(`Âä†ËΩΩ${wallet.name}‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
                    const balanceElement = document.getElementById(`balance-${wallet.name}`);
                    if (balanceElement) {
                        balanceElement.innerHTML = 'Âä†ËΩΩÂ§±Ë¥•';
                    }
                }
            }
        }

        // ÂàáÊç¢Èí±ÂåÖËØ¶ÊÉÖÊòæÁ§∫
        function toggleWalletDetails(walletName) {
            const detailsElement = document.getElementById(`details-${walletName}`);
            const expandBtn = event.target;
            
            if (detailsElement.classList.contains('expanded')) {
                detailsElement.classList.remove('expanded');
                expandBtn.textContent = 'Â±ïÂºÄËØ¶ÊÉÖ';
            } else {
                // ÂÖ≥Èó≠ÂÖ∂‰ªñÂ∑≤Â±ïÂºÄÁöÑËØ¶ÊÉÖ
                document.querySelectorAll('.wallet-details.expanded').forEach(el => {
                    el.classList.remove('expanded');
                });
                document.querySelectorAll('.expand-btn').forEach(btn => {
                    btn.textContent = 'Â±ïÂºÄËØ¶ÊÉÖ';
                });
                
                // Â±ïÂºÄÂΩìÂâçÈí±ÂåÖËØ¶ÊÉÖ
                detailsElement.classList.add('expanded');
                expandBtn.textContent = 'Êî∂Ëµ∑ËØ¶ÊÉÖ';
            }
        }

        // ÂèëÈÄÅ‰ª£Â∏ÅÂà∞Êñ∞Èí±ÂåÖÔºàÊ∞¥ÈæôÂ§¥ÂäüËÉΩÔºâ
        async function sendTokensToWallet(address) {
            try {
                addLog('info', `üí∞ Âêë ${address} ÂèëÈÄÅ token...`);
                const response = await fetch('http://localhost:3001/wallet/send-tokens', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        toAccount: address,
                        amount: '1000',
                        denom: 'token'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ ÊàêÂäüÂèëÈÄÅ 1000 token Âà∞Èí±ÂåÖ!`);
                    setTimeout(() => {
                        refreshWalletList();
                        refreshBalances();
                    }, 3000);
                } else {
                    addLog('error', `‚ùå ÂèëÈÄÅ token Â§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÂèëÈÄÅ token Â§±Ë¥•: ${error.message}`);
            }
        }

        // ÂèëÈÄÅ stake Âà∞Èí±ÂåÖÔºàË¥®Êäº‰ª£Â∏ÅÊ∞¥ÈæôÂ§¥Ôºâ
        async function sendStakeToWallet(address) {
            try {
                addLog('info', `ü•© Âêë ${address} ÂèëÈÄÅ stake...`);
                const response = await fetch('http://localhost:3001/wallet/send-tokens', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        toAccount: address,
                        amount: '1000',
                        denom: 'stake'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ ÊàêÂäüÂèëÈÄÅ 1000 stake Âà∞Èí±ÂåÖ!`);
                    addLog('info', `üìù Áé∞Âú®ÂèØ‰ª•Áî®Ëøô‰∫õ stake ËøõË°åË¥®ÊäºÊàñÂàõÂª∫È™åËØÅËÄÖ`);
                    setTimeout(() => {
                        refreshWalletList();
                        refreshBalances();
                    }, 3000);
                } else {
                    addLog('error', `‚ùå ÂèëÈÄÅ stake Â§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÂèëÈÄÅ stake Â§±Ë¥•: ${error.message}`);
            }
        }

        // ===========================================
        // Â•ñÂä±ÁÆ°ÁêÜÂäüËÉΩ
        // ===========================================
        
        let allRewards = [];
        
        // Âà∑Êñ∞Â•ñÂä±‰ø°ÊÅØ
        async function refreshRewards() {
            try {
                addLog('info', 'üîÑ Âà∑Êñ∞Â•ñÂä±‰ø°ÊÅØ...');
                
                allRewards = [];
                let totalAmount = 0;
                
                // Ëé∑ÂèñÊâÄÊúâÈí±ÂåÖÁöÑÂ•ñÂä±
                for (const wallet of allWallets) {
                    try {
                        const response = await fetch(`http://localhost:1317/cosmos/distribution/v1beta1/delegators/${wallet.address}/rewards`);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.rewards && data.rewards.length > 0) {
                                for (const reward of data.rewards) {
                                    if (reward.reward && reward.reward.length > 0) {
                                        const rewardInfo = {
                                            delegatorAddress: wallet.address,
                                            delegatorName: wallet.name,
                                            validatorAddress: reward.validator_address,
                                            rewards: reward.reward
                                        };
                                        allRewards.push(rewardInfo);
                                        
                                        // ËÆ°ÁÆóÊÄªÂ•ñÂä± (Âè™ËÆ°ÁÆó stake)
                                        for (const r of reward.reward) {
                                            if (r.denom === 'stake') {
                                                totalAmount += parseFloat(r.amount);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error(`Ëé∑Âèñ ${wallet.name} Â•ñÂä±Â§±Ë¥•:`, error);
                    }
                }
                
                displayRewards();
                updateTotalRewards(totalAmount);
                addLog('info', `‚úÖ Â•ñÂä±‰ø°ÊÅØÂ∑≤Êõ¥Êñ∞ÔºåÊÄªËÆ°: ${(totalAmount/1000000).toFixed(6)} stake`);
                
            } catch (error) {
                addLog('error', `‚ùå Âà∑Êñ∞Â•ñÂä±Â§±Ë¥•: ${error.message}`);
            }
        }
        
        // ÊòæÁ§∫Â•ñÂä±ÂàóË°®
        function displayRewards() {
            const container = document.getElementById('rewards-list');
            
            if (allRewards.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ÊöÇÊó†Êú™ÊèêÂèñÂ•ñÂä±</div>';
                return;
            }
            
            let html = '';
            for (const rewardInfo of allRewards) {
                // ÊâæÂà∞ÂØπÂ∫îÁöÑÈ™åËØÅËÄÖÂêçÁß∞
                const validator = allValidators.find(v => v.operator_address === rewardInfo.validatorAddress);
                const validatorName = validator ? validator.description.moniker : 'Êú™Áü•È™åËØÅËÄÖ';
                
                // ËÆ°ÁÆóÂ•ñÂä±ÈáëÈ¢ù
                const stakeReward = rewardInfo.rewards.find(r => r.denom === 'stake');
                const amount = stakeReward ? (parseFloat(stakeReward.amount) / 1000000).toFixed(6) : '0';
                
                if (parseFloat(amount) > 0.000001) { // Âè™ÊòæÁ§∫ÊúâÊÑè‰πâÁöÑÂ•ñÂä±
                    html += `
                        <div class="reward-item">
                            <div class="reward-info">
                                <div class="reward-amount">üí∞ ${amount} stake</div>
                                <div class="reward-validator">
                                    ÂßîÊâòËÄÖ: ${rewardInfo.delegatorName} ‚Üí È™åËØÅËÄÖ: ${validatorName}
                                </div>
                            </div>
                            <div class="reward-actions">
                                <button class="btn-reward" onclick="withdrawSpecificReward('${rewardInfo.delegatorAddress}', '${rewardInfo.validatorAddress}', '${rewardInfo.delegatorName}')">
                                    üí∏ ÊèêÂèñ
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            if (html === '') {
                html = '<div style="text-align: center; padding: 20px; color: #666;">ÊâÄÊúâÂ•ñÂä±ÈáëÈ¢ùÂ§™Â∞èÔºåÊöÇ‰∏çÊòæÁ§∫</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Êõ¥Êñ∞ÊÄªÂ•ñÂä±ÊòæÁ§∫
        function updateTotalRewards(totalAmount) {
            const totalDisplay = document.getElementById('total-reward-amount');
            const withdrawBtn = document.getElementById('withdraw-all-btn');
            
            const totalStake = (totalAmount / 1000000).toFixed(6);
            totalDisplay.textContent = `${totalStake} stake`;
            
            // Â¶ÇÊûúÊ≤°ÊúâÂ•ñÂä±ÔºåÁ¶ÅÁî®ÊèêÂèñÊåâÈíÆ
            if (parseFloat(totalStake) < 0.000001) {
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = 'üí∞ ÊöÇÊó†Â•ñÂä±ÂèØÊèêÂèñ';
            } else {
                withdrawBtn.disabled = false;
                withdrawBtn.textContent = 'üí∞ ÊèêÂèñÊâÄÊúâÂ•ñÂä±';
            }
        }
        
        // ÊèêÂèñÁâπÂÆöÂ•ñÂä±
        async function withdrawSpecificReward(delegatorAddress, validatorAddress, delegatorName) {
            try {
                addLog('info', `üèÜ Ê≠£Âú®‰∏∫ ${delegatorName} ÊèêÂèñÂ•ñÂä±...`);
                
                const response = await fetch('http://localhost:3001/rewards/withdraw', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        delegatorAddress: delegatorAddress,
                        validatorAddress: validatorAddress,
                        fromAccount: delegatorName
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ ${delegatorName} Â•ñÂä±ÊèêÂèñÊàêÂäü!`);
                    
                    // Á≠âÂæÖÂá†ÁßíÂêéÂà∑Êñ∞
                    setTimeout(() => {
                        refreshRewards();
                        refreshWalletList();
                    }, 3000);
                } else {
                    addLog('error', `‚ùå ÊèêÂèñÂ•ñÂä±Â§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÊèêÂèñÂ•ñÂä±Â§±Ë¥•: ${error.message}`);
            }
        }
        
        // ÊèêÂèñÊâÄÊúâÂ•ñÂä±
        async function withdrawAllRewards() {
            if (allRewards.length === 0) {
                addLog('warning', '‚ö†Ô∏è ÊöÇÊó†Â•ñÂä±ÂèØÊèêÂèñ');
                return;
            }
            
            addLog('info', 'üöÄ ÂºÄÂßãÊâπÈáèÊèêÂèñÊâÄÊúâÂ•ñÂä±...');
            
            let successCount = 0;
            let totalCount = 0;
            
            for (const rewardInfo of allRewards) {
                const stakeReward = rewardInfo.rewards.find(r => r.denom === 'stake');
                const amount = stakeReward ? parseFloat(stakeReward.amount) : 0;
                
                if (amount > 1000) { // Âè™ÊèêÂèñÊúâÊÑè‰πâÁöÑÂ•ñÂä±
                    totalCount++;
                    try {
                        const response = await fetch('http://localhost:3001/rewards/withdraw', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                delegatorAddress: rewardInfo.delegatorAddress,
                                validatorAddress: rewardInfo.validatorAddress,
                                fromAccount: rewardInfo.delegatorName
                            })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            successCount++;
                            addLog('info', `‚úÖ ${rewardInfo.delegatorName} Â•ñÂä±ÊèêÂèñÊàêÂäü`);
                        } else {
                            addLog('error', `‚ùå ${rewardInfo.delegatorName} Â•ñÂä±ÊèêÂèñÂ§±Ë¥•: ${result.error}`);
                        }
                        
                        // ÈÅøÂÖçËØ∑Ê±ÇËøáÂø´
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (error) {
                        addLog('error', `‚ùå ${rewardInfo.delegatorName} Â•ñÂä±ÊèêÂèñÂºÇÂ∏∏: ${error.message}`);
                    }
                }
            }
            
            addSuccessLog(`üéä ÊâπÈáèÊèêÂèñÂÆåÊàê! ÊàêÂäü: ${successCount}/${totalCount}`);
            
            // Á≠âÂæÖÂêéÂà∑Êñ∞
            setTimeout(() => {
                refreshRewards();
                refreshWalletList();
            }, 3000);
        }

        // ===========================================
        // È™åËØÅËÄÖÁÆ°ÁêÜÂäüËÉΩ
        // ===========================================

        // ÊòæÁ§∫ÂàõÂª∫È™åËØÅËÄÖË°®Âçï
        function showCreateValidator() {
            hideValidatorForms();
            document.getElementById('create-validator-form').style.display = 'block';
            updateValidatorAccountOptions();
        }

        // ÊòæÁ§∫ÂßîÊâòË°®Âçï
        function showDelegateForm() {
            hideValidatorForms();
            document.getElementById('delegate-form').style.display = 'block';
            updateValidatorAccountOptions();
            updateValidatorOptions();
        }

        // ÈöêËóèÊâÄÊúâÈ™åËØÅËÄÖË°®Âçï
        function hideValidatorForms() {
            document.getElementById('create-validator-form').style.display = 'none';
            document.getElementById('delegate-form').style.display = 'none';
        }

        // ÂàõÂª∫È™åËØÅËÄÖ
        async function createValidator() {
            const fromAccount = document.getElementById('validator-account').value;
            const amount = document.getElementById('validator-amount').value;
            const moniker = document.getElementById('validator-moniker').value;
            const commission = document.getElementById('validator-commission').value;

            if (!fromAccount || !amount || !moniker || !commission) {
                showStatus('ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ', 'error');
                return;
            }

            try {
                addLog('info', `‚ö° Ê≠£Âú®ÂàõÂª∫È™åËØÅËÄÖ: ${moniker}`);
                const response = await fetch('http://localhost:3001/validator/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAccount: fromAccount,
                        amount: amount,
                        moniker: moniker,
                        commissionRate: (parseFloat(commission) / 100).toString(),
                        maxCommissionRate: '0.20',
                        maxCommissionChangeRate: '0.01'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ È™åËØÅËÄÖ "${moniker}" ÂàõÂª∫ÊàêÂäü!`);
                    hideValidatorForms();
                    setTimeout(() => {
                        refreshValidatorList();
                        refreshBalances();
                    }, 5000);
                } else {
                    addLog('error', `‚ùå ÂàõÂª∫È™åËØÅËÄÖÂ§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÂàõÂª∫È™åËØÅËÄÖÂ§±Ë¥•: ${error.message}`);
            }
        }

        // ÂßîÊâòË¥®Êäº
        async function delegateStake() {
            const fromAccount = document.getElementById('delegate-account').value;
            const validatorAddress = document.getElementById('delegate-validator').value;
            const amount = document.getElementById('delegate-amount').value;

            if (!fromAccount || !validatorAddress || !amount) {
                showStatus('ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ', 'error');
                return;
            }

            try {
                addLog('info', `ü§ù Ê≠£Âú®ÂßîÊâòË¥®Êäº ${amount} stake...`);
                const response = await fetch('http://localhost:3001/validator/delegate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAccount: fromAccount,
                        validatorAddress: validatorAddress,
                        amount: amount
                    })
                });

                const result = await response.json();
                if (result.success) {
                    addSuccessLog(`üéâ ÂßîÊâòË¥®ÊäºÊàêÂäü!`);
                    hideValidatorForms();
                    setTimeout(() => {
                        refreshValidatorList();
                        refreshBalances();
                    }, 3000);
                } else {
                    addLog('error', `‚ùå ÂßîÊâòË¥®ÊäºÂ§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå ÂßîÊâòË¥®ÊäºÂ§±Ë¥•: ${error.message}`);
            }
        }

        // Âà∑Êñ∞È™åËØÅËÄÖÂàóË°®
        async function refreshValidatorList() {
            try {
                addLog('info', 'üîÑ Âà∑Êñ∞È™åËØÅËÄÖÂàóË°®...');
                const response = await fetch('http://localhost:3001/validators/list');
                const result = await response.json();
                
                if (result.success) {
                    allValidators = result.output.validators;
                    displayValidators();
                    addLog('info', `üèõÔ∏è Ëé∑ÂèñÂà∞ ${allValidators.length} ‰∏™È™åËØÅËÄÖ`);
                } else {
                    addLog('error', `‚ùå Ëé∑ÂèñÈ™åËØÅËÄÖÂàóË°®Â§±Ë¥•: ${result.error}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Ëé∑ÂèñÈ™åËØÅËÄÖÂàóË°®Â§±Ë¥•: ${error.message}`);
            }
        }

        // ÊòæÁ§∫È™åËØÅËÄÖÂàóË°®
        function displayValidators() {
            const container = document.getElementById('validators-container');
            
            if (allValidators.length === 0) {
                container.innerHTML = '<p>ÊöÇÊó†È™åËØÅËÄÖ</p>';
                return;
            }

            let html = '';
            for (const validator of allValidators) {
                const status = validator.status === 'BOND_STATUS_BONDED' ? 'bonded' : 'unbonded';
                const statusText = validator.status === 'BOND_STATUS_BONDED' ? 'Â∑≤ÁªëÂÆö' : 'Êú™ÁªëÂÆö';
                const tokens = (parseInt(validator.tokens) / 1000000).toLocaleString();

                html += `
                    <div class="validator-item">
                        <h4>‚ö° ${validator.description.moniker}</h4>
                        <div class="validator-address">${validator.operator_address}</div>
                        <div><span class="validator-status ${status}">${statusText}</span></div>
                        <div class="validator-tokens">Ë¥®Êäº: ${tokens} stake</div>
                        <div>‰Ω£ÈáëÁéá: ${(parseFloat(validator.commission.commission_rates.rate) * 100).toFixed(2)}%</div>
                        <div>ÊòØÂê¶ÁõëÁ¶Å: ${validator.jailed ? 'ÊòØ' : 'Âê¶'}</div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // Êõ¥Êñ∞Ë¥¶Êà∑ÈÄâÊã©ÈÄâÈ°π
        function updateAccountSelects() {
            const selects = [
                'from-account', 
                'to-account', 
                'validator-account', 
                'delegate-account'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">ÈÄâÊã©Ë¥¶Êà∑</option>';
                    allWallets.forEach(wallet => {
                        select.innerHTML += `<option value="${wallet.name}">${wallet.name} (${wallet.address})</option>`;
                    });
                }
            });
        }

        // Êõ¥Êñ∞È™åËØÅËÄÖÈÄâÊã©ÈÄâÈ°π
        function updateValidatorOptions() {
            const select = document.getElementById('delegate-validator');
            if (select) {
                select.innerHTML = '<option value="">ÈÄâÊã©È™åËØÅËÄÖ</option>';
                allValidators.forEach(validator => {
                    select.innerHTML += `<option value="${validator.operator_address}">${validator.description.moniker}</option>`;
                });
            }
        }

        // Êõ¥Êñ∞È™åËØÅËÄÖË¥¶Êà∑ÈÄâÈ°π
        function updateValidatorAccountOptions() {
            const selects = ['validator-account', 'delegate-account'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select && allWallets.length > 0) {
                    select.innerHTML = '<option value="">ÈÄâÊã©Ë¥¶Êà∑</option>';
                    allWallets.forEach(wallet => {
                        select.innerHTML += `<option value="${wallet.name}">${wallet.name}</option>`;
                    });
                }
            });
        }

        // Â§ÑÁêÜË°®ÂçïÂèòÂåñ
        document.getElementById('from-account').addEventListener('change', function() {
            const toSelect = document.getElementById('to-account');
            const fromValue = this.value;
            
            // Ëá™Âä®ËÆæÁΩÆÁõÆÊ†áË¥¶Êà∑‰∏∫Âè¶‰∏Ä‰∏™Ë¥¶Êà∑
            if (allWallets.length >= 2) {
                const otherWallet = allWallets.find(w => w.name !== fromValue);
                if (otherWallet) {
                    toSelect.value = otherWallet.name;
                }
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokenå¢å‘åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #45a049; }
        select, input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ”¨ Tokenå¢å‘åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="section">
        <h2>1. æµ‹è¯•é’±åŒ…åˆ—è¡¨API</h2>
        <button class="btn" onclick="testWalletList()">è·å–é’±åŒ…åˆ—è¡¨</button>
        <div id="wallet-result" class="log">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</div>
    </div>
    
    <div class="section">
        <h2>2. Tokenå¢å‘è¡¨å•</h2>
        <div>
            <label>ç®¡ç†å‘˜è´¦æˆ·:</label>
            <select id="from-account">
                <option value="">é€‰æ‹©è´¦æˆ·</option>
            </select>
        </div>
        <div>
            <label>æ¥æ”¶åœ°å€:</label>
            <select id="to-account">
                <option value="">é€‰æ‹©æ¥æ”¶è´¦æˆ·</option>
            </select>
        </div>
        <div>
            <label>å¢å‘æ•°é‡:</label>
            <input type="number" id="amount" placeholder="è¾“å…¥æ•°é‡" min="1">
        </div>
        <div>
            <label>ä»£å¸ç±»å‹:</label>
            <select id="denom">
                <option value="token">token</option>
                <option value="stake">stake</option>
            </select>
        </div>
        <button class="btn" onclick="testMint()">æµ‹è¯•å¢å‘</button>
        <div id="mint-result" class="log">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <script>
        let wallets = [];
        
        // æµ‹è¯•é’±åŒ…åˆ—è¡¨API
        async function testWalletList() {
            const resultDiv = document.getElementById('wallet-result');
            try {
                resultDiv.textContent = 'æ­£åœ¨è·å–é’±åŒ…åˆ—è¡¨...';
                
                const response = await fetch('http://localhost:3001/wallets/list');
                const data = await response.json();
                
                if (data.success) {
                    wallets = data.output;
                    resultDiv.textContent = `æˆåŠŸè·å– ${wallets.length} ä¸ªé’±åŒ…:\n` + 
                        wallets.map(w => `- ${w.name}: ${w.address}`).join('\n');
                    
                    // æ›´æ–°è¡¨å•é€‰é¡¹
                    updateSelects();
                } else {
                    resultDiv.textContent = `é”™è¯¯: ${data.error}`;
                }
            } catch (error) {
                resultDiv.textContent = `ç½‘ç»œé”™è¯¯: ${error.message}`;
            }
        }
        
        // æ›´æ–°é€‰æ‹©æ¡†
        function updateSelects() {
            const fromSelect = document.getElementById('from-account');
            const toSelect = document.getElementById('to-account');
            
            fromSelect.innerHTML = '<option value="">é€‰æ‹©ç®¡ç†å‘˜è´¦æˆ·</option>';
            toSelect.innerHTML = '<option value="">é€‰æ‹©æ¥æ”¶è´¦æˆ·</option>';
            
            wallets.forEach(wallet => {
                fromSelect.innerHTML += `<option value="${wallet.name}">${wallet.name}</option>`;
                toSelect.innerHTML += `<option value="${wallet.address}">${wallet.name} (${wallet.address})</option>`;
            });
        }
        
        // æµ‹è¯•å¢å‘åŠŸèƒ½
        async function testMint() {
            const resultDiv = document.getElementById('mint-result');
            const fromAccount = document.getElementById('from-account').value;
            const toAccount = document.getElementById('to-account').value;
            const amount = document.getElementById('amount').value;
            const denom = document.getElementById('denom').value;
            
            if (!fromAccount || !toAccount || !amount) {
                resultDiv.textContent = 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ';
                return;
            }
            
            try {
                resultDiv.textContent = 'æ­£åœ¨æ‰§è¡Œå¢å‘...';
                
                const response = await fetch('http://localhost:3001/token/mint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAccount: fromAccount,
                        toAccount: toAccount,
                        amount: amount,
                        denom: denom
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.textContent = `âœ… å¢å‘æˆåŠŸ!\nå‘½ä»¤: ${data.command}\nè¾“å‡º: ${JSON.stringify(data.output, null, 2)}`;
                } else {
                    resultDiv.textContent = `âŒ å¢å‘å¤±è´¥: ${data.error}`;
                }
            } catch (error) {
                resultDiv.textContent = `ç½‘ç»œé”™è¯¯: ${error.message}`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–é’±åŒ…åˆ—è¡¨
        window.addEventListener('load', () => {
            testWalletList();
        });
    </script>
</body>
</html>